<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—…ë¹„íŠ¸ ETH ì‹¤ì‹œê°„ ì‹ í˜¸ ë¶„ì„</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto 40px auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px 30px 30px 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 2px solid #eee;
        }
        
        .header h1 {
            margin: 0;
            color: #2c3e50;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            height: 600px;
        }
        
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .info-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
        }
        
        .signal-display {
            text-align: center;
            padding: 25px;
            border-radius: 15px;
            margin: 15px 0;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .signal-buy {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }
        
        .signal-sell {
            background: linear-gradient(135deg, #fc466b, #3f5efb);
            color: white;
        }
        
        .signal-hold {
            background: linear-gradient(135deg, #fdbb2d, #22c1c3);
            color: white;
        }
        
        .current-price {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin: 10px 0;
        }
        
        .indicators {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .indicator {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .indicator-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .indicator-label {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .gpt-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }
        
        .gpt-section h3 {
            margin-top: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        
        .gpt-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .gpt-guidance {
            flex: 0 0 40%;
            display: flex;
            flex-direction: column;
        }
        
        .gpt-guidance h4 {
            margin: 0 0 10px 0;
            font-size: 1em;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .guidance-input {
            width: 100%;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 0.9em;
            line-height: 1.4;
            resize: vertical;
            font-family: inherit;
            overflow-y: auto;
            overscroll-behavior: contain;
        }
        
        .guidance-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .guidance-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .gpt-analysis {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .gpt-content {
            height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            line-height: 1.6;
            flex: 1;
            /* ìŠ¤í¬ë¡¤ ì˜ì—­ ë…ë¦½ì„± ë³´ì¥ */
            overscroll-behavior: contain;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }
        
        .gpt-content::-webkit-scrollbar {
            width: 10px;
        }
        
        .gpt-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 5px;
            margin: 2px;
        }
        
        .gpt-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 5px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        
        .gpt-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.7);
            background-clip: content-box;
        }
        
        .gpt-content::-webkit-scrollbar-thumb:active {
            background: rgba(255, 255, 255, 0.8);
            background-clip: content-box;
        }
        
        .analyze-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .analyze-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
        }
        
        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* API í‚¤ ì„¤ì • ëª¨ë‹¬ */
        .api-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .api-modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .api-close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
        }
        
        .api-close:hover {
            color: #000;
        }
        
        .api-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin: 15px 0;
            font-family: monospace;
        }
        
        .api-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .api-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .api-btn:hover {
            transform: translateY(-1px);
        }
        
        .api-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .api-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .api-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .api-key-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }
        
        .api-key-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .api-key-btn.configured {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.5);
        }
        
        /* í† ê¸€ ë©”ë‰´ ì»¨í…Œì´ë„ˆ */
        .toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }
        
        /* ì½”ì¸ ì„ íƒ í† ê¸€ */
        .coin-selector {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
        }
        
        /* ì‹œê°„ í”„ë ˆì„ ì„ íƒ */
        .timeframe-selector {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
        }
        
        .timeframe-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 18px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.8em;
            transition: all 0.3s ease;
            background: transparent;
            color: #666;
            min-width: 60px;
        }
        
        .timeframe-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }
        
        .timeframe-btn:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .coin-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: all 0.3s ease;
            background: transparent;
            color: #666;
            min-width: 80px;
            position: relative;
            overflow: visible;
        }
        
        .coin-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }
        
        /* ë§¤ë§¤ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ */
        .coin-btn .signal-text {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7em;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 10px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
            pointer-events: none;
        }
        
        /* ë§¤ë§¤ ì‹ í˜¸ë³„ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .coin-btn.signal-strong-buy .signal-text,
        .coin-btn.signal-buy .signal-text,
        .coin-btn.signal-weak-buy .signal-text {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            opacity: 1;
        }
        
        .coin-btn.signal-strong-buy .signal-text::after { content: "ê°•ë§¤ìˆ˜"; }
        .coin-btn.signal-buy .signal-text::after { content: "ë§¤ìˆ˜"; }
        .coin-btn.signal-weak-buy .signal-text::after { content: "ì•½ë§¤ìˆ˜"; }
        
        .coin-btn.signal-hold .signal-text {
            background: linear-gradient(135deg, #ffd93d, #22c1c3);
            color: #333;
            opacity: 1;
        }
        .coin-btn.signal-hold .signal-text::after { content: "ê´€ë§"; }
        
        .coin-btn.signal-weak-sell .signal-text,
        .coin-btn.signal-sell .signal-text,
        .coin-btn.signal-strong-sell .signal-text {
            background: linear-gradient(135deg, #ff4d4f, #f5222d);
            color: white;
            opacity: 1;
        }
        
        .coin-btn.signal-weak-sell .signal-text::after { content: "ì•½ë§¤ë„"; }
        .coin-btn.signal-sell .signal-text::after { content: "ë§¤ë„"; }
        .coin-btn.signal-strong-sell .signal-text::after { content: "ê°•ë§¤ë„"; }
        
        .coin-btn:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .coin-btn .coin-icon {
            margin-right: 5px;
        }
        
        @media (max-width: 768px) {
            .toggle-container {
                flex-direction: column;
                gap: 15px;
                margin-bottom: 25px;
            }
            
            .coin-selector,
            .timeframe-selector {
                width: fit-content;
                margin: 0 auto;
            }
            
            .gpt-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .gpt-guidance {
                flex: none;
            }
            
            .guidance-input {
                height: 200px;
            }
            
            .gpt-content {
                height: 250px;
                overscroll-behavior: contain;
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 0 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .status {
            text-align: center;
            font-size: 0.9em;
            color: #7f8c8d;
            margin: 10px 0;
        }
        
        /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
        .tooltip {
            position: relative;
            cursor: pointer;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85em;
            line-height: 1.4;
            white-space: pre-line;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            min-width: 280px;
            max-width: 350px;
            text-align: left;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .tooltip::before {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(0, 0, 0, 0.95);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .tooltip:hover::after,
        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }
            
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.6em !important;
                margin-bottom: 15px;
            }
            
            .api-key-btn {
                font-size: 0.75em;
                padding: 6px 12px;
            }
            
            .toggle-container {
                flex-direction: column;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .coin-selector {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                padding: 10px;
            }
            
            .coin-btn {
                padding: 12px 16px;
                font-size: 0.85em;
                min-width: 85px;
                border-radius: 20px;
                margin: 3px;
            }
            
            /* ëª¨ë°”ì¼ì—ì„œ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì¡°ì • */
            .coin-btn .signal-text {
                top: -20px;
                font-size: 0.65em;
                padding: 1px 6px;
            }
            
            .timeframe-selector {
                justify-content: center;
            }
            
            .timeframe-btn {
                padding: 8px 15px;
                font-size: 0.8em;
                min-width: 60px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .chart-container {
                height: 350px;
                margin-bottom: 20px;
            }
            
            .info-panel {
                order: -1;
            }
            
            .info-card {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .current-price {
                font-size: 1.8em;
            }
            
            .indicators {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .indicator {
                padding: 12px;
            }
            
            .indicator-value {
                font-size: 1.1em;
            }
            
            .indicator-label {
                font-size: 0.75em;
            }
            
            .signal-display {
                padding: 20px;
                font-size: 1.1em;
            }
            
            .gpt-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .gpt-guidance,
            .gpt-analysis {
                flex: 1;
            }
            
            .guidance-input {
                height: 150px;
                font-size: 0.9em;
            }
            
            .gpt-content {
                font-size: 0.9em;
                line-height: 1.5;
                height: 200px;
                overscroll-behavior: contain;
            }
            
            .analyze-btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }
            
            .tooltip::after {
                min-width: 250px;
                max-width: 300px;
                font-size: 0.8em;
                padding: 10px 12px;
            }
            
            .status {
                font-size: 0.85em;
                padding: 10px;
            }
        }
        
        /* ì‘ì€ ëª¨ë°”ì¼ í™”ë©´ (480px ì´í•˜) */
        @media (max-width: 480px) {
            .coin-selector {
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }
            
            .coin-btn {
                width: 90%;
                max-width: 200px;
                text-align: center;
            }
            
            /* ì‘ì€ ëª¨ë°”ì¼ì—ì„œ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì¡°ì • */
            .coin-btn .signal-text {
                top: -18px;
                font-size: 0.6em;
                padding: 1px 5px;
            }
            
            .indicators {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .chart-container {
                height: 300px;
            }
            
            .header h1 {
                font-size: 1.4em !important;
            }
            
            .current-price {
                font-size: 1.6em;
            }
        }
        
        /* ë§¤ìš° ì‘ì€ í™”ë©´ (360px ì´í•˜) */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.2em !important;
                line-height: 1.3;
            }
            
            .coin-btn {
                width: 95%;
                padding: 14px 18px;
                font-size: 0.9em;
            }
            
            /* ë§¤ìš° ì‘ì€ í™”ë©´ì—ì„œ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì¡°ì • */
            .coin-btn .signal-text {
                top: -16px;
                font-size: 0.55em;
                padding: 1px 4px;
            }
            
            .chart-container {
                height: 280px;
            }
            
            .current-price {
                font-size: 1.5em;
            }
            
            .info-card {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í† ê¸€ ë©”ë‰´ ì»¨í…Œì´ë„ˆ -->
        <div class="toggle-container">
            <!-- ì½”ì¸ ì„ íƒ í† ê¸€ -->
            <div class="coin-selector tooltip" data-tooltip="ğŸª™ ê±°ë˜ ì¢…ëª© ì„ íƒ

ğŸ’° ì§€ì› ì¢…ëª©:
â€¢ ğŸŸ  ë¹„íŠ¸ì½”ì¸ (BTC/KRW)
â€¢ ğŸ”· ì´ë”ë¦¬ì›€ (ETH/KRW)
â€¢ ğŸ“± ì‚¼ì„±ì „ì (005930/KRW)


ğŸ“Š ì¢…ëª©ë³„ ë…ë¦½ì  ë¶„ì„:
â€¢ ê°ê°ì˜ ê¸°ìˆ ì  ì§€í‘œ
â€¢ ë§ì¶¤í˜• AI ë¶„ì„
â€¢ ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸">
                <button class="coin-btn active" data-coin="BTC" onclick="selectCoin('BTC')">
                    <span class="signal-text"></span>
                    <span class="coin-icon">ğŸŸ </span>
                    <span class="coin-name">ë¹„íŠ¸ì½”ì¸</span>
                </button>
                <button class="coin-btn" data-coin="ETH" onclick="selectCoin('ETH')">
                    <span class="signal-text"></span>
                    <span class="coin-icon">ğŸ”·</span>
                    <span class="coin-name">ì´ë”ë¦¬ì›€</span>
                </button>
                <button class="coin-btn" data-coin="XRP" onclick="selectCoin('XRP')">
                    <span class="signal-text"></span>
                    <span class="coin-icon">ğŸ’§</span>
                    <span class="coin-name">ì—‘ìŠ¤ì•Œí”¼</span>
                </button>
                <button class="coin-btn" data-coin="DOGE" onclick="selectCoin('DOGE')">
                    <span class="signal-text"></span>
                    <span class="coin-icon">ğŸ¶</span>
                    <span class="coin-name">ë„ì§€ì½”ì¸</span>
                </button>
                <button class="coin-btn" data-coin="SOL" onclick="selectCoin('SOL')">
                    <span class="signal-text"></span>
                    <span class="coin-icon">ğŸŒ</span>
                    <span class="coin-name">ì†”ë¼ë‚˜</span>
                </button>
                <button class="coin-btn" data-coin="TRUMP" onclick="selectCoin('TRUMP')">
                    <span class="signal-text"></span>
                    <span class="coin-icon">ğŸ‡ºğŸ‡¸</span>
                    <span class="coin-name">ì˜¤í”¼ì…œíŠ¸ëŸ¼í”„</span>
                </button>
            </div>
            
            <!-- ì‹œê°„ í”„ë ˆì„ ì„ íƒ -->
            <div class="timeframe-selector tooltip" data-tooltip="â° ì°¨íŠ¸ ì‹œê°„ í”„ë ˆì„ ì„ íƒ

ğŸ“Š ì§€ì› ì‹œê°„ í”„ë ˆì„:
â€¢ 5ë¶„ë´‰: ë‹¨ê¸° ë§¤ë§¤ìš© (30ì´ˆë§ˆë‹¤ ê°±ì‹ )
â€¢ 1ì‹œê°„ë´‰: ì¤‘ê¸° ë¶„ì„ìš© (5ë¶„ë§ˆë‹¤ ê°±ì‹ )  
â€¢ ì¼ë´‰: ì¥ê¸° ë¶„ì„ìš© (30ë¶„ë§ˆë‹¤ ê°±ì‹ )
â€¢ ì£¼ë´‰: ì´ˆì¥ê¸° ë¶„ì„ìš© (2ì‹œê°„ë§ˆë‹¤ ê°±ì‹ )

ğŸ’¡ ì¼ë´‰ ì´ìƒ ê¶Œì¥ (ì•ˆì •ì  ì‹ í˜¸)
ğŸ”„ í´ë¦­í•˜ë©´ ì¦‰ì‹œ í•´ë‹¹ ì‹œê°„ í”„ë ˆì„ìœ¼ë¡œ ë³€ê²½">
                <button class="timeframe-btn" id="btn5m" onclick="selectTimeframe('5m')">5ë¶„</button>
                <button class="timeframe-btn" id="btn1h" onclick="selectTimeframe('1h')">1ì‹œê°„</button>
                <button class="timeframe-btn active" id="btn1d" onclick="selectTimeframe('1d')">ì¼ë´‰</button>
                <button class="timeframe-btn" id="btn1w" onclick="selectTimeframe('1w')">ì£¼ë´‰</button>
            </div>
        </div>
        
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h1 id="mainTitle" style="margin: 0; font-size: 2.2em;">âš¡ ì‹¤ì‹œê°„ ê³ ê¸‰ ê¸°ìˆ ì  ë¶„ì„ ì‹œìŠ¤í…œ</h1>
                <button class="api-key-btn tooltip" id="apiKeyBtn" onclick="openApiModal()" data-tooltip="ğŸ”‘ OpenAI API í‚¤ ì„¤ì •

ğŸ¤– GPT AI ë¶„ì„ì„ ì‚¬ìš©í•˜ë ¤ë©´ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤
ğŸ”’ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
ğŸ’° OpenAI ê³„ì •ì—ì„œ ë°œê¸‰ë°›ìœ¼ì„¸ìš”

âš ï¸ API í‚¤ëŠ” ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ì„¸ìš”">
                    ğŸ”‘ API í‚¤ ì„¤ì •
                </button>
            </div>
            <div class="status" id="status">ì‹œìŠ¤í…œ ì¤€ë¹„ ì¤‘...</div>
        </div>
        
        <div class="controls">
            <button class="btn tooltip" data-tooltip="âš¡ ìë™ ê°±ì‹  ì„¤ì •

ğŸ”„ ì„ íƒëœ ì‹œê°„ í”„ë ˆì„ì— ë”°ë¼ ìë™ ì—…ë°ì´íŠ¸
ğŸ“Š 5ë¶„ë´‰: 30ì´ˆë§ˆë‹¤ / 1ì‹œê°„ë´‰: 5ë¶„ë§ˆë‹¤
ğŸ“Š ì¼ë´‰: 30ë¶„ë§ˆë‹¤ / ì£¼ë´‰: 2ì‹œê°„ë§ˆë‹¤
ğŸ”› ON/OFF í† ê¸€ ê°€ëŠ¥

ğŸ’¡ ì‹œê°„ í”„ë ˆì„ì— ìµœì í™”ëœ ê°±ì‹  ì£¼ê¸°" onclick="toggleAutoUpdate()">ìë™ ê°±ì‹  í† ê¸€</button>
            <button class="btn tooltip" data-tooltip="ğŸ”„ ì¦‰ì‹œ ê°±ì‹ 

ğŸ“Š ìµœì‹  ë°ì´í„°ë¡œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
âš¡ ëª¨ë“  ì§€í‘œ ì¬ê³„ì‚°
ğŸ¤– AI ë¶„ì„ ìƒˆë¡œ ìš”ì²­

ğŸ’¡ ì¤‘ìš”í•œ ì‹œì ì— ì¦‰ì‹œ í™•ì¸" onclick="draw()">ìˆ˜ë™ ê°±ì‹ </button>
        </div>
        
        <div class="main-content">
            <div class="chart-container tooltip" id="chartContainer" data-tooltip="ğŸ“Š ì „ë¬¸ BTC/KRW ì¢…í•© ì°¨íŠ¸

ğŸ“ˆ í‘œì‹œ í•­ëª©:
â€¢ ğŸ“ˆ BTC ì¢…ê°€/ê³ ê°€/ì €ê°€
â€¢ ğŸŸ¡ MA(5) - ë‹¨ê¸° ì¶”ì„¸ì„ 
â€¢ ğŸ”´ MA(20) - ì¤‘ê¸° ì¶”ì„¸ì„   
â€¢ ğŸŸ£ MA(60) - ì¥ê¸° ì¶”ì„¸ì„ 
â€¢ ğŸ”´ ë³¼ë¦°ì € ìƒë‹¨ ë°´ë“œ
â€¢ ğŸŸ¢ ë³¼ë¦°ì € í•˜ë‹¨ ë°´ë“œ
â€¢ ğŸ“Š ê±°ë˜ëŸ‰ (ìš°ì¸¡ ì¶•)

ğŸ’¡ ì°¨íŠ¸ ê¸°ëŠ¥:
â€¢ ë§ˆìš°ìŠ¤ í˜¸ë²„ë¡œ ì •í™•í•œ ê°’ í™•ì¸
â€¢ ë²”ë¡€ í´ë¦­ìœ¼ë¡œ ë¼ì¸ ON/OFF
â€¢ ë°˜ì‘í˜• ì°¨íŠ¸">
                <canvas id="priceChart"></canvas>
            </div>
            
            <div class="info-panel">
                <div class="info-card">
                    <h3 class="tooltip" id="priceTitle" data-tooltip="ğŸ’° ì‹¤ì‹œê°„ BTC ê°€ê²©

ğŸ” ì—…ë¹„íŠ¸ 5ë¶„ë´‰ ê¸°ì¤€ ìµœì‹  ê±°ë˜ê°€
ğŸ“Š ëª¨ë“  ê¸°ìˆ ì  ë¶„ì„ì˜ ê¸°ì¤€ì´ ë˜ëŠ” í˜„ì¬ê°€
âš¡ 30ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸">ğŸ’° í˜„ì¬ ê°€ê²©</h3>
                    <div class="current-price" id="currentPrice">ë¡œë”© ì¤‘...</div>
                    
                    <div class="indicators">
                        <div class="indicator tooltip" data-tooltip="ğŸ“Š RSI (ìƒëŒ€ê°•ë„ì§€ìˆ˜)

ğŸ” ê°œë…: 14ì¼ê°„ ìƒìŠ¹/í•˜ë½ í­ì„ ë¹„êµí•˜ì—¬ ê³¼ë§¤ìˆ˜/ê³¼ë§¤ë„ë¥¼ íŒë‹¨

ğŸ“ˆ í™œìš©ë²•:
â€¢ 30 ì´í•˜: ê³¼ë§¤ë„ êµ¬ê°„ â†’ ë§¤ìˆ˜ íƒ€ì´ë°
â€¢ 70 ì´ìƒ: ê³¼ë§¤ìˆ˜ êµ¬ê°„ â†’ ë§¤ë„ íƒ€ì´ë°
â€¢ 50 ê·¼ì²˜: ì¤‘ë¦½, ì¶”ì„¸ í™•ì¸ í•„ìš”

âš ï¸ ì£¼ì˜: ê°•í•œ ì¶”ì„¸ì—ì„œëŠ” ê³¼ë§¤ìˆ˜/ê³¼ë§¤ë„ê°€ ì§€ì†ë  ìˆ˜ ìˆìŒ">
                            <div class="indicator-value" id="rsiValue">-</div>
                            <div class="indicator-label">RSI (14)</div>
                        </div>
                        <div class="indicator tooltip" data-tooltip="ğŸ“Š MACD (ì´ë™í‰ê·  ìˆ˜ë ´í™•ì‚°ì§€í‘œ)

ğŸ” ê°œë…: 12ì¼/26ì¼ ì§€ìˆ˜ì´ë™í‰ê· ì˜ ì°¨ì´ì™€ 9ì¼ ì‹ í˜¸ì„ 

ğŸ“ˆ í™œìš©ë²•:
â€¢ MACD > Signal: ìƒìŠ¹ ëª¨ë©˜í…€
â€¢ MACD < Signal: í•˜ë½ ëª¨ë©˜í…€
â€¢ 0ì„  ëŒíŒŒ: ì¶”ì„¸ ì „í™˜ ì‹ í˜¸
â€¢ ë‹¤ì´ë²„ì „ìŠ¤: ì¶”ì„¸ ì•½í™” ì‹ í˜¸

âš¡ íŠ¹ì§•: ì¶”ì„¸ ì¶”ì¢…í˜• ì§€í‘œ, ì§€ì—°ì„± ìˆìŒ">
                            <div class="indicator-value" id="macdValue">-</div>
                            <div class="indicator-label">MACD</div>
                        </div>
                        <div class="indicator tooltip" data-tooltip="ğŸ“Š ë³¼ë¦°ì € ë°´ë“œ ìœ„ì¹˜

ğŸ” ê°œë…: 20ì¼ ì´ë™í‰ê·  Â± 2í‘œì¤€í¸ì°¨ ë°´ë“œ

ğŸ“ˆ í™œìš©ë²•:
â€¢ ğŸŸ¢ í•˜ë‹¨: ê³¼ë§¤ë„, ë°˜ë“± ê°€ëŠ¥ì„± ë†’ìŒ
â€¢ ğŸ”´ ìƒë‹¨: ê³¼ë§¤ìˆ˜, ì¡°ì • ê°€ëŠ¥ì„± ë†’ìŒ
â€¢ ğŸŸ¡ ìƒë¶€/í•˜ë¶€: ì¤‘ê°„ ì˜ì—­, ì¶”ì„¸ í™•ì¸
â€¢ ë°´ë“œ ì¶•ì†Œ: ë³€ë™ì„± ê°ì†Œ, í° ì›€ì§ì„ ì˜ˆê³ 

ğŸ’¡ íŒ: ë°´ë“œ ì´íƒˆ í›„ ì¬ì§„ì…ì´ ë” ì•ˆì „í•œ ì‹ í˜¸">
                            <div class="indicator-value" id="bbValue">-</div>
                            <div class="indicator-label">ë³¼ë¦°ì € ìœ„ì¹˜</div>
                        </div>
                        <div class="indicator tooltip" data-tooltip="ğŸ“Š ATR (í‰ê· ì§„ì‹¤ë²”ìœ„)

ğŸ” ê°œë…: 14ì¼ê°„ ì‹¤ì œ ê°€ê²© ë³€ë™í­ì˜ í‰ê· 

ğŸ“ˆ í™œìš©ë²•:
â€¢ ë†’ì€ ATR: ë³€ë™ì„± í° ì‹œì¥, í° ìˆ˜ìµ/ì†ì‹¤ ê°€ëŠ¥
â€¢ ë‚®ì€ ATR: ì•ˆì •ì  ì‹œì¥, ì‘ì€ ë³€ë™
â€¢ ì†ì ˆì„  ì„¤ì •: í˜„ì¬ê°€ Â± (ATR Ã— 2)
â€¢ í¬ì§€ì…˜ í¬ê¸° ì¡°ì ˆ ê¸°ì¤€

âš ï¸ ë¦¬ìŠ¤í¬ ê´€ë¦¬ì˜ í•µì‹¬ ì§€í‘œ">
                            <div class="indicator-value" id="atrValue">-</div>
                            <div class="indicator-label">ATR ë³€ë™ì„±</div>
                        </div>
                        <div class="indicator tooltip" data-tooltip="ğŸ“Š ì´ë™í‰ê· ì„  ê´´ë¦¬ìœ¨

ğŸ” ê°œë…: í˜„ì¬ê°€ê°€ 20ì¼ ì´ë™í‰ê· ì—ì„œ ì–¼ë§ˆë‚˜ ë–¨ì–´ì ¸ ìˆëŠ”ì§€

ğŸ“ˆ í™œìš©ë²•:
â€¢ +15% ì´ìƒ: ê³¼ë„í•œ ìƒìŠ¹, ì¡°ì • ê°€ëŠ¥ì„±
â€¢ -15% ì´í•˜: ê³¼ë„í•œ í•˜ë½, ë°˜ë“± ê°€ëŠ¥ì„±
â€¢ Â±5% ì´ë‚´: ì •ìƒ ë²”ìœ„
â€¢ 0% ê·¼ì²˜: ì´í‰ì„  í„°ì¹˜, ì§€ì§€/ì €í•­ í™•ì¸

ğŸ’¡ í‰ê·  íšŒê·€ ì„±í–¥ì„ ì´ìš©í•œ ë§¤ë§¤ ì „ëµ">
                            <div class="indicator-value" id="divergenceValue">-</div>
                            <div class="indicator-label">ê´´ë¦¬ìœ¨ (%)</div>
                        </div>
                        <div class="indicator tooltip" data-tooltip="ğŸ“Š ì´ë™í‰ê· ì„  ë°°ì—´

ğŸ” ê°œë…: MA5, MA20, MA60ì˜ ìƒí•˜ ê´€ê³„

ğŸ“ˆ í™œìš©ë²•:
â€¢ ğŸŸ¢ ì •ë°°ì—´ (5>20>60): ê°•í•œ ìƒìŠ¹ì¶”ì„¸
â€¢ ğŸ”´ ì—­ë°°ì—´ (5<20<60): ê°•í•œ í•˜ë½ì¶”ì„¸
â€¢ ğŸŸ¡ í˜¼ì¬: ë°•ìŠ¤ê¶Œ, ë°©í–¥ì„± ì—†ìŒ

âš¡ ê³¨ë“ í¬ë¡œìŠ¤/ë°ë“œí¬ë¡œìŠ¤:
â€¢ ë‹¨ê¸°ì„ ì´ ì¥ê¸°ì„  ìƒí–¥ëŒíŒŒ â†’ ë§¤ìˆ˜ì‹ í˜¸
â€¢ ë‹¨ê¸°ì„ ì´ ì¥ê¸°ì„  í•˜í–¥ëŒíŒŒ â†’ ë§¤ë„ì‹ í˜¸">
                            <div class="indicator-value" id="maStatus">-</div>
                            <div class="indicator-label">ì´í‰ì„  ë°°ì—´</div>
                        </div>
                    </div>
                </div>
                
                <div class="info-card">
                    <h3 class="tooltip" data-tooltip="ğŸ“Š ì¢…í•© ë§¤ë§¤ ì‹ í˜¸

ğŸ” 13ê°€ì§€ ê¸°ìˆ ì  ì§€í‘œ ì¢…í•© ë¶„ì„ ê²°ê³¼
ğŸ“ˆ ì‹ í˜¸ ì¢…ë¥˜:
â€¢ ğŸŸ¢ ë§¤ìˆ˜: ìƒìŠ¹ ì‹ í˜¸ ìš°ì„¸
â€¢ ğŸ”´ ë§¤ë„: í•˜ë½ ì‹ í˜¸ ìš°ì„¸  
â€¢ ğŸŸ¡ ê´€ë§: ëª…í™•í•œ ë°©í–¥ì„± ì—†ìŒ

âš¡ ì‹ ë¢°ë„: 50~95% (ì§€í‘œ ì¼ì¹˜ë„ì— ë”°ë¼)
ğŸ’¡ ë†’ì€ ì‹ ë¢°ë„ì¼ìˆ˜ë¡ ì‹ í˜¸ ì •í™•ì„± ì¦ê°€">ğŸ“Š ë§¤ë§¤ ì‹ í˜¸</h3>
                    <div class="signal-display" id="signal">ë¶„ì„ ì¤‘...</div>
                    <div style="text-align: center; margin-top: 15px;">
                        <strong class="tooltip" data-tooltip="ğŸ¯ ì‹ ë¢°ë„ ê³„ì‚°ë²•

ğŸ“Š ë§¤ìˆ˜/ë§¤ë„ ì‹ í˜¸ ë¹„ì¤‘ + ê±°ë˜ëŸ‰ ë³´ì •
ğŸ”¢ ê³„ì‚°ì‹: ê¸°ë³¸ 50% + (ì‹ í˜¸ ì¼ì¹˜ë„ Ã— 45%) + (ê±°ë˜ëŸ‰ ë³´ì • 5%)

ğŸ“ˆ ì‹ ë¢°ë„ í•´ì„:
â€¢ 90%+: ë§¤ìš° ê°•í•œ ì‹ í˜¸
â€¢ 80-89%: ê°•í•œ ì‹ í˜¸
â€¢ 70-79%: ë³´í†µ ì‹ í˜¸
â€¢ 60-69%: ì•½í•œ ì‹ í˜¸
â€¢ 50-59%: ë¶ˆí™•ì‹¤">ì‹ ë¢°ë„: <span id="confidence">-</span>%</strong>
                    </div>
                    <div style="margin-top: 15px;">
                        <strong class="tooltip" data-tooltip="ğŸ“‹ ê°ì§€ëœ ì‹ í˜¸ ìƒì„¸ ë‚´ì—­

ğŸŸ¢ ë§¤ìˆ˜ ì‹ í˜¸:
â€¢ ê³¨ë“ í¬ë¡œìŠ¤, MACD ìƒí–¥êµì°¨, RSI ê³¼ë§¤ë„ ë“±

ğŸ”´ ë§¤ë„ ì‹ í˜¸:  
â€¢ ë°ë“œí¬ë¡œìŠ¤, MACD í•˜í–¥êµì°¨, RSI ê³¼ë§¤ìˆ˜ ë“±

ğŸ“ˆ ë³´ì¡° ì‹ í˜¸:
â€¢ ê±°ë˜ëŸ‰ ê¸‰ì¦, ë‹¤ì´ë²„ì „ìŠ¤, ë³¼ë¦°ì € ëŒíŒŒ ë“±">ğŸ“‹ ì‹ í˜¸ ë‚´ì—­:</strong>
                        <div id="signalList" style="font-size: 0.85em; margin-top: 10px; line-height: 1.4;">
                            ë¶„ì„ ì¤‘...
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="gpt-section">
            <h3 class="tooltip" data-tooltip="ğŸ¤– GPT AI ë¶„ì„ ë¦¬í¬íŠ¸

ğŸ” OpenAI GPT-3.5 ëª¨ë¸ì´ ì œê³µí•˜ëŠ” ì „ë¬¸ ë¶„ì„
ğŸ“Š ë¶„ì„ ë°ì´í„°: 15ê°œ ìµœê·¼ ê°€ê²© + 8ê°œ ì§€í‘œê°’
ğŸ“ˆ ì œê³µ ì •ë³´:
â€¢ í˜„ì¬ ì¶”ì„¸ ë°©í–¥ì„± ë¶„ì„
â€¢ ë§¤ìˆ˜/ë§¤ë„ ì‹ í˜¸ + ì‹ ë¢°ë„
â€¢ ì§€ì§€/ì €í•­ì„  ì˜ˆìƒ êµ¬ê°„
â€¢ ë‹¨ê¸° ëª©í‘œê°€/ì†ì ˆì„  ì œì‹œ
â€¢ ìœ„í—˜ ìš”ì†Œ ë° ì£¼ì˜ì‚¬í•­

âš ï¸ íˆ¬ì ê¶Œìœ ê°€ ì•„ë‹Œ ê¸°ìˆ ì  ë¶„ì„ ì˜ê²¬">
                <span>ğŸ¤– AI ë¶„ì„ ë¦¬í¬íŠ¸</span>
                <button class="analyze-btn tooltip" data-tooltip="ğŸ” AI ë¶„ì„ ì‹¤í–‰

ğŸ’¡ GPT-3.5ë¡œ ì‹¬í™” ë¶„ì„ ìš”ì²­
ğŸ“Š ìµœì‹  ë°ì´í„°ë¡œ ì „ë¬¸ ë¶„ì„
âš¡ í´ë¦­ ì‹œì—ë§Œ í† í° ì†Œë¹„
ğŸ“ ì™¼ìª½ ì§€ì¹¨ê³¼ í•¨ê»˜ ë¶„ì„

ğŸ’° í† í° ì ˆì•½ì„ ìœ„í•œ ìˆ˜ë™ ë¶„ì„" onclick="requestGPTAnalysis()" id="analyzeBtn">
                    <span>ğŸ”</span>
                    <span>ë¶„ì„</span>
                </button>
            </h3>
            
            <div class="gpt-container">
                <!-- ì™¼ìª½: ì§€ì¹¨ ì…ë ¥ ì˜ì—­ -->
                <div class="gpt-guidance">
                    <h4 class="tooltip" data-tooltip="ğŸ“ AI ë¶„ì„ ì§€ì¹¨ ì„¤ì •

ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ:
â€¢ 'ë³´ìˆ˜ì ì¸ ê´€ì ì—ì„œ ë¶„ì„í•´ì¤˜'
â€¢ 'ë‹¨ê¸° ìŠ¤ìœ™ íŠ¸ë ˆì´ë”© ê´€ì ì—ì„œ ë´ì¤˜'
â€¢ 'ë¦¬ìŠ¤í¬ë¥¼ ì¤‘ì ì ìœ¼ë¡œ ë¶„ì„í•´ì¤˜'
â€¢ 'ê¸°ê´€ íˆ¬ìì ê´€ì ì—ì„œ ë¶„ì„í•´ì¤˜'

ğŸ¯ íš¨ê³¼:
â€¢ ë§ì¶¤í˜• ë¶„ì„ ë°©í–¥ ì„¤ì •
â€¢ íŠ¹ì • ê´€ì ì˜ ì‹¬í™” ë¶„ì„
â€¢ ê°œì¸ íˆ¬ì ì„±í–¥ ë°˜ì˜

ğŸ“ ë¹„ì›Œë‘¬ë„ ê¸°ë³¸ ë¶„ì„ ì‹¤í–‰">ğŸ“ ë¶„ì„ ì§€ì¹¨</h4>
                    <textarea class="guidance-input tooltip" id="guidanceInput" 
                        placeholder="AIì—ê²Œ ì „ë‹¬í•  ë¶„ì„ ì§€ì¹¨ì„ ì…ë ¥í•˜ì„¸ìš”...

ì˜ˆì‹œ:
- ë³´ìˆ˜ì ì¸ ê´€ì ì—ì„œ ë¦¬ìŠ¤í¬ë¥¼ ì¤‘ì ì ìœ¼ë¡œ ë¶„ì„í•´ì£¼ì„¸ìš”
- ë‹¨ê¸° ìŠ¤ìœ™ íŠ¸ë ˆì´ë”© ê´€ì ì—ì„œ ì§„ì…/ì²­ì‚° íƒ€ì´ë°ì„ ì•Œë ¤ì£¼ì„¸ìš”  
- ê¸°ê´€ íˆ¬ìì ê´€ì ì—ì„œ ì¤‘ì¥ê¸° ì „ëµì„ ì œì‹œí•´ì£¼ì„¸ìš”
- ê³¼ê±° íŒ¨í„´ ë¹„êµë¥¼ í†µí•œ ì˜ˆìƒ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì œì‹œí•´ì£¼ì„¸ìš”

ğŸ’¡ êµ¬ì²´ì ì¸ ì§€ì¹¨ì¼ìˆ˜ë¡ ë” ì •í™•í•œ ë¶„ì„ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                        data-tooltip="ğŸ“ ë§ì¶¤í˜• AI ë¶„ì„ ì§€ì¹¨

ğŸ¯ ì…ë ¥ ê°€ì´ë“œ:
â€¢ íˆ¬ì ìŠ¤íƒ€ì¼ (ë³´ìˆ˜ì /ê³µê²©ì /ì¤‘ë¦½ì )
â€¢ ì‹œê°„ ê´€ì  (ë‹¨ê¸°/ì¤‘ê¸°/ì¥ê¸°)
â€¢ ì¤‘ì  ë¶„ì•¼ (ë¦¬ìŠ¤í¬/ìˆ˜ìµ/íƒ€ì´ë°)
â€¢ íŠ¹ë³„ ìš”ì²­ (íŒ¨í„´ ë¶„ì„, ì‹œë‚˜ë¦¬ì˜¤ ë“±)

ğŸ’¡ ì˜ˆì‹œ ì§€ì¹¨:
'ë³´ìˆ˜ì  ê´€ì ì—ì„œ í•˜ë½ ë¦¬ìŠ¤í¬ ì¤‘ì  ë¶„ì„'
'ë‹¨ê¸° ë§¤ë§¤ë¥¼ ìœ„í•œ ì§„ì…ì ê³¼ ì†ì ˆì  ì œì‹œ'
'ê³¼ê±° ë¹„ìŠ·í•œ íŒ¨í„´ê³¼ ë¹„êµ ë¶„ì„'

ğŸ“ ë¹„ì›Œë‘¬ë„ ê¸°ë³¸ ë¶„ì„ ìˆ˜í–‰"></textarea>
                </div>
                
                <!-- ì˜¤ë¥¸ìª½: AI ë¶„ì„ ê²°ê³¼ ì˜ì—­ -->
                <div class="gpt-analysis">
                    <h4 style="margin: 0 0 10px 0; font-size: 1em; color: rgba(255, 255, 255, 0.9);">ğŸ¤– AI ë¶„ì„ ê²°ê³¼</h4>
                    <div class="gpt-content" id="gptSignal">
                        ğŸ’¡ <strong>AI ë¶„ì„ì„ ë°›ìœ¼ë ¤ë©´ ìœ„ì˜ 'ë¶„ì„' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!</strong><br><br>
                        ğŸ¤– GPT-3.5ê°€ í˜„ì¬ ë¹„íŠ¸ì½”ì¸ ì¼ë´‰ ì°¨íŠ¸ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤.<br>
                        ğŸ“Š ì„ íƒëœ ì‹œê°„ í”„ë ˆì„ì— ë§ëŠ” ê¸°ìˆ ì  ì§€í‘œë¡œ ì „ë¬¸ì ì¸ ì˜ê²¬ì„ ì œê³µí•©ë‹ˆë‹¤.<br>
                        ğŸ“ ì™¼ìª½ì— ë¶„ì„ ì§€ì¹¨ì„ ì…ë ¥í•˜ë©´ ë§ì¶¤í˜• ë¶„ì„ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>
                        âš ï¸ <em>í† í° ì ˆì•½ì„ ìœ„í•´ í•„ìš”í•  ë•Œë§Œ ë¶„ì„ì„ ìš”ì²­í•˜ì„¸ìš”.</em>
                    </div>
                </div>
            </div>
        </div>
            </div>

        <!-- API í‚¤ ì„¤ì • ëª¨ë‹¬ -->
        <div id="apiModal" class="api-modal">
            <div class="api-modal-content">
                <span class="api-close" onclick="closeApiModal()">&times;</span>
                <h2 style="margin-top: 0; color: #2c3e50;">ğŸ”‘ OpenAI API í‚¤ ì„¤ì •</h2>
                
                <p style="color: #666; line-height: 1.6;">
                    AI ë¶„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ OpenAI API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br>
                    API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì™¸ë¶€ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </p>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4 style="margin: 0 0 10px 0; color: #495057;">ğŸ“ API í‚¤ ë°œê¸‰ ë°©ë²•:</h4>
                    <ol style="margin: 0; padding-left: 20px; color: #6c757d;">
                        <li><a href="https://platform.openai.com/api-keys" target="_blank" style="color: #667eea;">OpenAI í”Œë«í¼</a>ì— ë¡œê·¸ì¸</li>
                        <li>"Create new secret key" í´ë¦­</li>
                        <li>ìƒì„±ëœ í‚¤ë¥¼ ë³µì‚¬í•´ì„œ ì•„ë˜ì— ì…ë ¥</li>
                    </ol>
                </div>
                
                <label for="apiKeyInput" style="display: block; margin-bottom: 5px; font-weight: bold; color: #495057;">
                    API í‚¤ ì…ë ¥:
                </label>
                <input type="password" id="apiKeyInput" class="api-input" placeholder="OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
                       style="box-sizing: border-box;">
                
                <div style="margin-top: 20px;">
                    <button class="api-btn" onclick="saveApiKey()">ğŸ’¾ ì €ì¥</button>
                    <button class="api-btn" onclick="testApiKey()" style="background: #28a745;">ğŸ” í…ŒìŠ¤íŠ¸</button>
                    <button class="api-btn" onclick="clearApiKey()" style="background: #dc3545;">ğŸ—‘ï¸ ì‚­ì œ</button>
                </div>
                
                <div id="apiStatus" class="api-status" style="display: none;"></div>
                
                <div style="margin-top: 20px; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                    <small style="color: #856404;">
                        âš ï¸ <strong>ë³´ì•ˆ ì£¼ì˜:</strong> API í‚¤ë¥¼ ë‹¤ë¥¸ ì‚¬ëŒê³¼ ê³µìœ í•˜ì§€ ë§ˆì„¸ìš”. 
                        ì‚¬ìš©ëŸ‰ì— ë”°ë¼ OpenAI ìš”ê¸ˆì´ ë¶€ê³¼ë©ë‹ˆë‹¤.
                    </small>
                </div>
            </div>
        </div>

    <script>
        // OpenAI API Key (ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥)
        let OPENAI_API_KEY = "";
        
        // í”„ë¡ì‹œ ì„œë²„ ì„¤ì • (API í‚¤ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥)
        const USE_PROXY_SERVER = false; // ì‚¬ìš©ìê°€ ì§ì ‘ API í‚¤ ì…ë ¥
        
        // í”„ë¡ì‹œ ì„œë²„ ì£¼ì†Œ ì„¤ì •
        // ë¡œì»¬ Express ì„œë²„: "http://localhost:3001"
        // Vercel Functions: "" (í˜„ì¬ ë„ë©”ì¸ ì‚¬ìš©, api/gpt ì—”ë“œí¬ì¸íŠ¸)
        // Railway/Heroku: "https://your-app.railway.app" ë˜ëŠ” "https://your-app.herokuapp.com"
        const PROXY_SERVER_URL = ""; // Vercel Functions ì‚¬ìš©ì‹œ ë¹ˆ ë¬¸ìì—´
        
        let chart;
        let autoUpdate = true;
        let updateInterval;
        
        // í˜„ì¬ ì„ íƒëœ ì½”ì¸ (ê¸°ë³¸ê°’: BTC)
        let selectedCoin = 'BTC';
        
        // í˜„ì¬ ì„ íƒëœ ì‹œê°„ í”„ë ˆì„ (ê¸°ë³¸ê°’: ì¼ë´‰)
        let selectedTimeframe = '1d';
        
        // ëª¨ë“  ì½”ì¸ì˜ ì‹ í˜¸ ë¶„ì„ ê²°ê³¼ ì €ì¥
        let allCoinSignals = {
            'BTC': { signal: 'HOLD', confidence: 0, lastUpdate: null },
            'ETH': { signal: 'HOLD', confidence: 0, lastUpdate: null },
            'XRP': { signal: 'HOLD', confidence: 0, lastUpdate: null },
            'DOGE': { signal: 'HOLD', confidence: 0, lastUpdate: null },
            'SOL': { signal: 'HOLD', confidence: 0, lastUpdate: null },
            'TRUMP': { signal: 'HOLD', confidence: 0, lastUpdate: null }
        };
        
        // ì½”ì¸/ì£¼ì‹ë³„ ì •ë³´
        const coinInfo = {
            'BTC': {
                name: 'ë¹„íŠ¸ì½”ì¸',
                symbol: 'BTC',
                market: 'KRW-BTC',
                icon: 'ğŸŸ ',
                color: '#f7931a',
                type: 'crypto',
                currency: 'KRW'
            },
            'ETH': {
                name: 'ì´ë”ë¦¬ì›€',
                symbol: 'ETH',
                market: 'KRW-ETH',
                icon: 'ğŸ”·',
                color: '#627eea',
                type: 'crypto',
                currency: 'KRW'
            },
            'XRP': {
                name: 'ì—‘ìŠ¤ì•Œí”¼(ë¦¬í”Œ)',
                symbol: 'XRP',
                market: 'KRW-XRP',
                icon: 'ğŸ’§',
                color: '#23292f',
                type: 'crypto',
                currency: 'KRW'
            },
            'DOGE': {
                name: 'ë„ì§€ì½”ì¸',
                symbol: 'DOGE',
                market: 'KRW-DOGE',
                icon: 'ğŸ¶',
                color: '#c2a633',
                type: 'crypto',
                currency: 'KRW'
            },
            'SOL': {
                name: 'ì†”ë¼ë‚˜',
                symbol: 'SOL',
                market: 'KRW-SOL',
                icon: 'ğŸŒ',
                color: '#9945ff',
                type: 'crypto',
                currency: 'KRW'
            },
            'TRUMP': {
                name: 'ì˜¤í”¼ì…œíŠ¸ëŸ¼í”„',
                symbol: 'TRUMP',
                market: 'KRW-TRUMP',
                icon: 'ğŸ‡ºğŸ‡¸',
                color: '#ff0000',
                type: 'crypto',
                currency: 'KRW'
            }
        };
        
        // ì‹œê°„ í”„ë ˆì„ë³„ ì •ë³´
        const timeframeInfo = {
            '5m': {
                name: '5ë¶„ë´‰',
                apiPath: 'minutes/5',
                updateInterval: 30000,  // 30ì´ˆ
                description: 'ë‹¨ê¸° ë§¤ë§¤'
            },
            '1h': {
                name: '1ì‹œê°„ë´‰', 
                apiPath: 'minutes/60',
                updateInterval: 300000, // 5ë¶„
                description: 'ì¤‘ê¸° ë¶„ì„'
            },
            '1d': {
                name: 'ì¼ë´‰',
                apiPath: 'days',
                updateInterval: 1800000, // 30ë¶„
                description: 'ì¥ê¸° ë¶„ì„'
            },
            '1w': {
                name: 'ì£¼ë´‰',
                apiPath: 'weeks', 
                updateInterval: 7200000, // 2ì‹œê°„
                description: 'ì´ˆì¥ê¸° ë¶„ì„'
            }
        };
        
        // GPT ë¶„ì„ì„ ìœ„í•œ ìµœì‹  ë°ì´í„° ì €ì¥ (ëª¨ë“  ì§€í‘œ í¬í•¨)
        let latestAnalysisData = {
            closes: [],
            highs: [],
            lows: [],
            rsi: [],
            macd: { macd: [], signal: [], histogram: [] },
            ma5: [],
            ma20: [],
            ma60: [],
            bb: { upper: [], middle: [], lower: [] },
            atr: [],
            volumes: [],
            divergenceRate: [],
            divergence: null,
            currentPrice: 0,
            currentRSI: 0,
            currentMACD: 0,
            currentATR: 0,
            currentDivergenceRate: 0,
            maStatus: '',
            bbPosition: ''
        };
        
        // ì‹œê°„ í”„ë ˆì„ ì„ íƒ í•¨ìˆ˜
        function selectTimeframe(timeframe) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.timeframe-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ìƒˆë¡œìš´ ì„ íƒ í™œì„±í™”
            const btnId = 'btn' + timeframe;
            document.getElementById(btnId).classList.add('active');
            
            // ì„ íƒëœ ì‹œê°„ í”„ë ˆì„ ì—…ë°ì´íŠ¸
            selectedTimeframe = timeframe;
            const tfInfo = timeframeInfo[timeframe];
            const coinInfoCurrent = coinInfo[selectedCoin];
            
            // ìë™ ê°±ì‹  ì£¼ê¸° ë³€ê²½
            if (autoUpdate) {
                clearInterval(updateInterval);
                updateInterval = setInterval(draw, tfInfo.updateInterval);
            }
            
            // ì°¨íŠ¸ ì œëª© ì—…ë°ì´íŠ¸
            if (chart) {
                const currentCoin = coinInfo[selectedCoin];
                chart.options.plugins.title.text = `${currentCoin.symbol}/KRW ${tfInfo.name} ê¸°ìˆ ì  ë¶„ì„ ì°¨íŠ¸`;
            }
            
            // GPT ë¶„ì„ ì˜ì—­ ì´ˆê¸°í™”
            document.getElementById('gptSignal').innerHTML = `
                ğŸ’¡ <strong>AI ë¶„ì„ì„ ë°›ìœ¼ë ¤ë©´ ìœ„ì˜ 'ë¶„ì„' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!</strong><br><br>
                ğŸ¤– GPT-3.5ê°€ í˜„ì¬ ${coinInfoCurrent.name} ${tfInfo.name} ì°¨íŠ¸ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤.<br>
                ğŸ“Š ì„ íƒëœ ì‹œê°„ í”„ë ˆì„ì— ë§ëŠ” ê¸°ìˆ ì  ì§€í‘œë¡œ ì „ë¬¸ì ì¸ ì˜ê²¬ì„ ì œê³µí•©ë‹ˆë‹¤.<br><br>
                âš ï¸ <em>í† í° ì ˆì•½ì„ ìœ„í•´ í•„ìš”í•  ë•Œë§Œ ë¶„ì„ì„ ìš”ì²­í•˜ì„¸ìš”.</em>
            `;
            
            // ìµœì‹  ë°ì´í„° ì´ˆê¸°í™”
            latestAnalysisData = {
                closes: [],
                highs: [],
                lows: [],
                rsi: [],
                macd: { macd: [], signal: [], histogram: [] },
                ma5: [],
                ma20: [],
                ma60: [],
                bb: { upper: [], middle: [], lower: [] },
                atr: [],
                volumes: [],
                divergenceRate: [],
                divergence: null,
                currentPrice: 0,
                currentRSI: 0,
                currentMACD: 0,
                currentATR: 0,
                currentDivergenceRate: 0,
                maStatus: '',
                bbPosition: ''
            };
            
            // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            document.getElementById('status').textContent = `${tfInfo.name}ìœ¼ë¡œ ë³€ê²½ë¨ - ë°ì´í„° ë¡œë”© ì¤‘...`;
            
            // ìƒˆë¡œìš´ ì‹œê°„ í”„ë ˆì„ ë°ì´í„°ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            draw();
        }
        
        // ì½”ì¸ ì„ íƒ í•¨ìˆ˜
        function selectCoin(coin) {
            // ì´ì „ ì„ íƒ í•´ì œ
            // ëª¨ë“  ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.coin-btn').forEach(btn => btn.classList.remove('active'));

            
            // ìƒˆë¡œìš´ ì„ íƒ í™œì„±í™”
            document.querySelector(`[data-coin="${coin}"]`).classList.add('active');
            
            // ì„ íƒëœ ì½”ì¸ ì—…ë°ì´íŠ¸
            selectedCoin = coin;
            const info = coinInfo[coin];
            
            // ì œëª© ì—…ë°ì´íŠ¸
            document.getElementById('mainTitle').textContent = `âš¡ ${info.name} ì‹¤ì‹œê°„ ë¶„ì„ ì‹œìŠ¤í…œ`;
            
            // ì°¨íŠ¸ê°€ ì¡´ì¬í•˜ë©´ ì—…ë°ì´íŠ¸
            if (chart) {
                const tfInfo = timeframeInfo[selectedTimeframe];
                chart.options.plugins.title.text = `${info.symbol}/${info.currency} ${tfInfo.name} ê¸°ìˆ ì  ë¶„ì„ ì°¨íŠ¸`;
                chart.data.datasets[0].label = `${info.symbol} ì¢…ê°€`;
                chart.data.datasets[1].label = `${info.symbol} ê³ ê°€`;
                chart.data.datasets[2].label = `${info.symbol} ì €ê°€`;
                chart.options.scales.y.title.text = `ê°€ê²© (${info.currency})`;
                chart.update();
            }
            
            // íˆ´íŒ ì—…ë°ì´íŠ¸
            document.getElementById('priceTitle').setAttribute('data-tooltip', `ğŸ’° ì‹¤ì‹œê°„ ${info.name} ê°€ê²©

ğŸ” ì—…ë¹„íŠ¸ 5ë¶„ë´‰ ê¸°ì¤€ ìµœì‹  ê±°ë˜ê°€
ğŸ“Š ëª¨ë“  ê¸°ìˆ ì  ë¶„ì„ì˜ ê¸°ì¤€ì´ ë˜ëŠ” í˜„ì¬ê°€
âš¡ 30ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸`);

            document.getElementById('chartContainer').setAttribute('data-tooltip', `ğŸ“Š ì „ë¬¸ ${info.symbol}/KRW ì¢…í•© ì°¨íŠ¸

ğŸ“ˆ í‘œì‹œ í•­ëª©:
â€¢ ğŸ“ˆ ${info.symbol} ì¢…ê°€/ê³ ê°€/ì €ê°€
â€¢ ğŸŸ¡ MA(5) - ë‹¨ê¸° ì¶”ì„¸ì„ 
â€¢ ğŸ”´ MA(20) - ì¤‘ê¸° ì¶”ì„¸ì„   
â€¢ ğŸŸ£ MA(60) - ì¥ê¸° ì¶”ì„¸ì„ 
â€¢ ğŸ”´ ë³¼ë¦°ì € ìƒë‹¨ ë°´ë“œ
â€¢ ğŸŸ¢ ë³¼ë¦°ì € í•˜ë‹¨ ë°´ë“œ
â€¢ ğŸ“Š ê±°ë˜ëŸ‰ (ìš°ì¸¡ ì¶•)

ğŸ’¡ ì°¨íŠ¸ ê¸°ëŠ¥:
â€¢ ë§ˆìš°ìŠ¤ í˜¸ë²„ë¡œ ì •í™•í•œ ê°’ í™•ì¸
â€¢ ë²”ë¡€ í´ë¦­ìœ¼ë¡œ ë¼ì¸ ON/OFF
â€¢ ë°˜ì‘í˜• ì°¨íŠ¸`);
            
            // GPT ë¶„ì„ ì˜ì—­ ì´ˆê¸°í™”
            document.getElementById('gptSignal').innerHTML = `
                ğŸ’¡ <strong>AI ë¶„ì„ì„ ë°›ìœ¼ë ¤ë©´ ìœ„ì˜ 'ë¶„ì„' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!</strong><br><br>
                ğŸ¤– GPT-3.5ê°€ í˜„ì¬ ${info.name} ì‹œì¥ ìƒí™©ì„ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤.<br>
                ğŸ“Š 15ê°œ ìµœê·¼ ê°€ê²© ë°ì´í„°ì™€ 8ê°œ ê¸°ìˆ ì  ì§€í‘œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ë¬¸ì ì¸ ì˜ê²¬ì„ ì œê³µí•©ë‹ˆë‹¤.<br><br>
                âš ï¸ <em>í† í° ì ˆì•½ì„ ìœ„í•´ í•„ìš”í•  ë•Œë§Œ ë¶„ì„ì„ ìš”ì²­í•˜ì„¸ìš”.</em>
            `;
            
            // ìµœì‹  ë°ì´í„° ì´ˆê¸°í™”
            latestAnalysisData = {
                closes: [],
                highs: [],
                lows: [],
                rsi: [],
                macd: { macd: [], signal: [], histogram: [] },
                ma5: [],
                ma20: [],
                ma60: [],
                bb: { upper: [], middle: [], lower: [] },
                atr: [],
                volumes: [],
                divergenceRate: [],
                divergence: null,
                currentPrice: 0,
                currentRSI: 0,
                currentMACD: 0,
                currentATR: 0,
                currentDivergenceRate: 0,
                maStatus: '',
                bbPosition: ''
            };
            
            // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            document.getElementById('status').textContent = `${info.name} ì¢…ëª©ìœ¼ë¡œ ë³€ê²½ë¨ - ë°ì´í„° ë¡œë”© ì¤‘...`;
            
            // ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            draw();
        }
        
        // ì°¨íŠ¸ ì´ˆê¸°í™” (Chart.js ì‚¬ìš©)
        function initChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'BTC ì¢…ê°€',
                        data: [],
                        borderColor: '#1f77b4',
                        backgroundColor: 'rgba(31, 119, 180, 0.1)',
                        tension: 0.1,
                        fill: false,
                        borderWidth: 2,
                        order: 1
                    }, {
                        label: 'BTC ê³ ê°€',
                        data: [],
                        borderColor: 'rgba(255, 99, 132, 0.3)',
                        backgroundColor: 'transparent',
                        tension: 0.1,
                        fill: false,
                        borderWidth: 1,
                        borderDash: [2, 2],
                        order: 2
                    }, {
                        label: 'BTC ì €ê°€',
                        data: [],
                        borderColor: 'rgba(54, 162, 235, 0.3)',
                        backgroundColor: 'transparent',
                        tension: 0.1,
                        fill: false,
                        borderWidth: 1,
                        borderDash: [2, 2],
                        order: 3
                    }, {
                        label: 'MA(5)',
                        data: [],
                        borderColor: '#fbbf24',
                        backgroundColor: 'transparent',
                        tension: 0.1,
                        fill: false,
                        borderWidth: 2,
                        order: 4
                    }, {
                        label: 'MA(20)',
                        data: [],
                        borderColor: '#ef4444',
                        backgroundColor: 'transparent',
                        tension: 0.1,
                        fill: false,
                        borderWidth: 2,
                        order: 5
                    }, {
                        label: 'MA(60)',
                        data: [],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'transparent',
                        tension: 0.1,
                        fill: false,
                        borderWidth: 2,
                        order: 6
                    }, {
                        label: 'ë³¼ë¦°ì € ìƒë‹¨',
                        data: [],
                        borderColor: 'rgba(239, 68, 68, 0.5)',
                        backgroundColor: 'transparent',
                        tension: 0.1,
                        fill: false,
                        borderWidth: 1,
                        borderDash: [5, 5],
                        order: 7
                    }, {
                        label: 'ë³¼ë¦°ì € í•˜ë‹¨',
                        data: [],
                        borderColor: 'rgba(34, 197, 94, 0.5)',
                        backgroundColor: 'transparent',
                        tension: 0.1,
                        fill: false,
                        borderWidth: 1,
                        borderDash: [5, 5],
                        order: 8
                    }, {
                        label: 'ê±°ë˜ëŸ‰',
                        data: [],
                        type: 'bar',
                        backgroundColor: 'rgba(75, 192, 192, 0.3)',
                        borderColor: 'rgba(75, 192, 192, 0.8)',
                        borderWidth: 1,
                        yAxisID: 'volume',
                        order: 9
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'BTC/KRW ê³ ê¸‰ ê¸°ìˆ ì  ë¶„ì„ ì°¨íŠ¸'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            type: 'category',
                            title: {
                                display: true,
                                text: 'ì‹œê°„'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'ê°€ê²© (KRW)'
                            },
                            grid: {
                                drawOnChartArea: true,
                            },
                        },
                        volume: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'ê±°ë˜ëŸ‰'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            beginAtZero: true
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
        
        // RSI ê³„ì‚°
        function calculateRSI(prices, period = 14) {
            if (prices.length < period + 1) return [];
            
            const rsi = [];
            for (let i = period; i < prices.length; i++) {
                let gains = 0;
                let losses = 0;
                
                for (let j = i - period + 1; j <= i; j++) {
                    const change = prices[j] - prices[j - 1];
                    if (change > 0) gains += change;
                    else losses -= change;
                }
                
                const avgGain = gains / period;
                const avgLoss = losses / period;
                const rs = avgGain / avgLoss;
                const rsiValue = 100 - (100 / (1 + rs));
                
                rsi.push(rsiValue);
            }
            
            return rsi;
        }
        
        // ì´ë™í‰ê·  ê³„ì‚°
        function calculateMA(prices, period = 20) {
            if (prices.length < period) return [];
            
            const ma = [];
            for (let i = period - 1; i < prices.length; i++) {
                const sum = prices.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
                ma.push(sum / period);
            }
            
            return ma;
        }
        
        // MACD ê³„ì‚°
        function calculateMACD(prices, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
            if (prices.length < slowPeriod) return { macd: [], signal: [], histogram: [] };
            
            // EMA ê³„ì‚° í•¨ìˆ˜
            const calculateEMA = (data, period) => {
                const ema = [];
                const multiplier = 2 / (period + 1);
                ema[0] = data[0];
                
                for (let i = 1; i < data.length; i++) {
                    ema[i] = (data[i] * multiplier) + (ema[i - 1] * (1 - multiplier));
                }
                return ema;
            };
            
            const fastEMA = calculateEMA(prices, fastPeriod);
            const slowEMA = calculateEMA(prices, slowPeriod);
            
            const macd = [];
            for (let i = 0; i < prices.length; i++) {
                if (fastEMA[i] && slowEMA[i]) {
                    macd.push(fastEMA[i] - slowEMA[i]);
                }
            }
            
            const signal = calculateEMA(macd, signalPeriod);
            const histogram = [];
            
            for (let i = 0; i < macd.length; i++) {
                if (signal[i]) {
                    histogram.push(macd[i] - signal[i]);
                }
            }
            
            return { macd, signal, histogram };
        }
        
        // ë³¼ë¦°ì € ë°´ë“œ ê³„ì‚°
        function calculateBollingerBands(prices, period = 20, stdDev = 2) {
            if (prices.length < period) return { upper: [], middle: [], lower: [] };
            
            const upper = [];
            const middle = [];
            const lower = [];
            
            for (let i = period - 1; i < prices.length; i++) {
                const slice = prices.slice(i - period + 1, i + 1);
                const avg = slice.reduce((a, b) => a + b, 0) / period;
                const variance = slice.reduce((sum, price) => sum + Math.pow(price - avg, 2), 0) / period;
                const std = Math.sqrt(variance);
                
                middle.push(avg);
                upper.push(avg + (std * stdDev));
                lower.push(avg - (std * stdDev));
            }
            
            return { upper, middle, lower };
        }
        
        // ATR (Average True Range) ê³„ì‚°
        function calculateATR(highs, lows, closes, period = 14) {
            if (highs.length < period + 1) return [];
            
            const trueRanges = [];
            for (let i = 1; i < highs.length; i++) {
                const tr1 = highs[i] - lows[i];
                const tr2 = Math.abs(highs[i] - closes[i - 1]);
                const tr3 = Math.abs(lows[i] - closes[i - 1]);
                trueRanges.push(Math.max(tr1, tr2, tr3));
            }
            
            const atr = [];
            for (let i = period - 1; i < trueRanges.length; i++) {
                const sum = trueRanges.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
                atr.push(sum / period);
            }
            
            return atr;
        }
        
        // ê´´ë¦¬ìœ¨ ê³„ì‚°
        function calculateDivergenceRate(prices, ma) {
            if (!ma || ma.length === 0) return [];
            
            const divergence = [];
            const startIndex = prices.length - ma.length;
            
            for (let i = 0; i < ma.length; i++) {
                const price = prices[startIndex + i];
                const maValue = ma[i];
                const rate = ((price - maValue) / maValue) * 100;
                divergence.push(rate);
            }
            
            return divergence;
        }
        
        // ë‹¤ì´ë²„ì „ìŠ¤ ê°ì§€
        function detectDivergence(prices, indicator, lookback = 20) {
            if (prices.length < lookback || indicator.length < lookback) return null;
            
            const priceSlice = prices.slice(-lookback);
            const indicatorSlice = indicator.slice(-lookback);
            
            const priceHighIndex = priceSlice.indexOf(Math.max(...priceSlice));
            const priceLowIndex = priceSlice.indexOf(Math.min(...priceSlice));
            const indicatorHigh = Math.max(...indicatorSlice);
            const indicatorLow = Math.min(...indicatorSlice);
            
            // ë² ì–´ë¦¬ì‹œ ë‹¤ì´ë²„ì „ìŠ¤ (ê°€ê²© ê³ ì  ê°±ì‹ , ì§€í‘œ ê³ ì  í•˜ë½)
            if (priceHighIndex > lookback * 0.7 && indicatorSlice[priceHighIndex] < indicatorHigh * 0.95) {
                return 'bearish';
            }
            
            // ë¶ˆë¦¬ì‹œ ë‹¤ì´ë²„ì „ìŠ¤ (ê°€ê²© ì €ì  ê°±ì‹ , ì§€í‘œ ì €ì  ìƒìŠ¹)
            if (priceLowIndex > lookback * 0.7 && indicatorSlice[priceLowIndex] > indicatorLow * 1.05) {
                return 'bullish';
            }
            
            return null;
        }
        
        // ê³ ê¸‰ ë§¤ë§¤ ì‹ í˜¸ ë¶„ì„
        function analyzeAdvancedSignal(data) {
            const {
                price, prices, rsi, ma5, ma20, ma60, macd, bb, 
                volumes, atr, divergenceRate, divergence
            } = data;
            
            let buySignals = 0;
            let sellSignals = 0;
            let signalStrength = 0;
            let signals = [];
            
            // 1. ê³¨ë“ í¬ë¡œìŠ¤/ë°ë“œí¬ë¡œìŠ¤ í™•ì¸
            if (ma5 && ma20 && ma60) {
                const ma5Current = ma5[ma5.length - 1];
                const ma20Current = ma20[ma20.length - 1];
                const ma60Current = ma60[ma60.length - 1];
                
                if (ma5Current > ma20Current && ma20Current > ma60Current) {
                    buySignals += 2;
                    signals.push('ğŸŸ¢ ê³¨ë“ í¬ë¡œìŠ¤ (5>20>60)');
                } else if (ma5Current < ma20Current && ma20Current < ma60Current) {
                    sellSignals += 2;
                    signals.push('ğŸ”´ ë°ë“œí¬ë¡œìŠ¤ (5<20<60)');
                }
            }
            
            // 2. RSI ì‹ í˜¸
            if (rsi) {
                if (rsi < 30) {
                    buySignals += 1;
                    signals.push('ğŸŸ¢ RSI ê³¼ë§¤ë„ êµ¬ê°„');
                } else if (rsi > 70) {
                    sellSignals += 1;
                    signals.push('ğŸ”´ RSI ê³¼ë§¤ìˆ˜ êµ¬ê°„');
                }
            }
            
            // 3. MACD ì‹ í˜¸
            if (macd && macd.macd.length > 1 && macd.signal.length > 1) {
                const macdCurrent = macd.macd[macd.macd.length - 1];
                const macdPrev = macd.macd[macd.macd.length - 2];
                const signalCurrent = macd.signal[macd.signal.length - 1];
                const signalPrev = macd.signal[macd.signal.length - 2];
                
                // MACD ìƒí–¥ êµì°¨
                if (macdPrev <= signalPrev && macdCurrent > signalCurrent) {
                    buySignals += 2;
                    signals.push('ğŸŸ¢ MACD ìƒí–¥ êµì°¨');
                }
                // MACD í•˜í–¥ êµì°¨
                else if (macdPrev >= signalPrev && macdCurrent < signalCurrent) {
                    sellSignals += 2;
                    signals.push('ğŸ”´ MACD í•˜í–¥ êµì°¨');
                }
            }
            
            // 4. ë³¼ë¦°ì € ë°´ë“œ ì‹ í˜¸
            if (bb && bb.upper.length > 0) {
                const upperBand = bb.upper[bb.upper.length - 1];
                const lowerBand = bb.lower[bb.lower.length - 1];
                const middleBand = bb.middle[bb.middle.length - 1];
                
                if (price <= lowerBand) {
                    buySignals += 1;
                    signals.push('ğŸŸ¢ ë³¼ë¦°ì € í•˜ë‹¨ ì ‘ì´‰');
                } else if (price >= upperBand) {
                    sellSignals += 1;
                    signals.push('ğŸ”´ ë³¼ë¦°ì € ìƒë‹¨ ì ‘ì´‰');
                } else if (price > middleBand) {
                    buySignals += 0.5;
                }
            }
            
            // 5. ê´´ë¦¬ìœ¨ ì‹ í˜¸
            if (divergenceRate && divergenceRate.length > 0) {
                const currentDivergence = divergenceRate[divergenceRate.length - 1];
                if (currentDivergence < -15) {
                    buySignals += 1;
                    signals.push('ğŸŸ¢ ì´í‰ì„  ëŒ€ë¹„ ê³¼ë„í•œ í•˜ë½');
                } else if (currentDivergence > 15) {
                    sellSignals += 1;
                    signals.push('ğŸ”´ ì´í‰ì„  ëŒ€ë¹„ ê³¼ë„í•œ ìƒìŠ¹');
                }
            }
            
            // 6. ë‹¤ì´ë²„ì „ìŠ¤ ì‹ í˜¸
            if (divergence) {
                if (divergence === 'bullish') {
                    buySignals += 2;
                    signals.push('ğŸŸ¢ ê°•í•œ ë¶ˆë¦¬ì‹œ ë‹¤ì´ë²„ì „ìŠ¤');
                } else if (divergence === 'bearish') {
                    sellSignals += 2;
                    signals.push('ğŸ”´ ê°•í•œ ë² ì–´ë¦¬ì‹œ ë‹¤ì´ë²„ì „ìŠ¤');
                }
            }
            
            // 7. ê±°ë˜ëŸ‰ í™•ì¸ (ì„ì˜ ë³¼ë¥¨ ì¦ê°€ ì‹œë®¬ë ˆì´ì…˜)
            if (volumes && volumes.length > 1) {
                const currentVol = volumes[volumes.length - 1];
                const avgVol = volumes.slice(-20).reduce((a,b) => a+b, 0) / 20;
                
                if (currentVol > avgVol * 1.5) {
                    signalStrength += 1;
                    signals.push('ğŸ“ˆ ê±°ë˜ëŸ‰ ê¸‰ì¦');
                }
            }
            
            // ìµœì¢… ì‹ í˜¸ ê²°ì •
            let finalSignal = 'ê´€ë§';
            let confidence = 50;
            
            const totalSignals = buySignals + sellSignals;
            if (totalSignals > 0) {
                if (buySignals > sellSignals * 1.5) {
                    finalSignal = 'ë§¤ìˆ˜';
                    confidence = Math.min(95, 50 + (buySignals / totalSignals) * 45 + signalStrength * 5);
                } else if (sellSignals > buySignals * 1.5) {
                    finalSignal = 'ë§¤ë„';
                    confidence = Math.min(95, 50 + (sellSignals / totalSignals) * 45 + signalStrength * 5);
                }
            }
            
            return {
                signal: finalSignal,
                confidence: Math.round(confidence),
                signals: signals,
                buySignals,
                sellSignals
            };
        }
        
        // ê³ ê¸‰ GPT API í˜¸ì¶œ (ì „ì²´ ì§€í‘œ ë°ì´í„° í¬í•¨)
        async function getGPTSignal(analysisData) {
            // í”„ë¡ì‹œ ì„œë²„ ì‚¬ìš© ì‹œ API í‚¤ ë¶ˆí•„ìš”
            if (!USE_PROXY_SERVER && !OPENAI_API_KEY) {
                return `ğŸ”‘ <strong>API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!</strong><br><br>
                AI ë¶„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ OpenAI API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br><br>
                ğŸ“ <strong>ì„¤ì • ë°©ë²•:</strong><br>
                1. ìš°ì¸¡ ìƒë‹¨ì˜ "ğŸ”‘ API í‚¤ ì„¤ì •" ë²„íŠ¼ í´ë¦­<br>
                2. OpenAI í”Œë«í¼ì—ì„œ API í‚¤ ë°œê¸‰<br>
                3. ë°œê¸‰ë°›ì€ í‚¤ë¥¼ ì…ë ¥ í›„ ì €ì¥<br><br>
                ğŸ’¡ ì„¤ì • í›„ ë‹¤ì‹œ ë¶„ì„ ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.`;
            }
            
            try {
                const { closes, highs, lows, rsi, macd, ma5, ma20, ma60, bb, atr, volumes, divergenceRate, 
                        currentPrice, currentRSI, currentMACD, currentATR, currentDivergenceRate, maStatus, bbPosition } = analysisData;
                
                const recentPrices = closes.slice(-15);
                const recentRSI = rsi.slice(-8);
                const recentMA20 = ma20.slice(-8);
                const recentMA5 = ma5.slice(-8);
                const recentMA60 = ma60.slice(-8);
                const recentMACD = macd.macd.slice(-8);
                const recentVolumes = volumes.slice(-8);
                
                // ì¶”ê°€ ë¶„ì„ ì •ë³´
                const priceChange = ((closes[closes.length-1] - closes[closes.length-2]) / closes[closes.length-2] * 100).toFixed(2);
                const maDistance = ((closes[closes.length-1] - ma20[ma20.length-1]) / ma20[ma20.length-1] * 100).toFixed(2);
                
                const currentCoin = coinInfo[selectedCoin];
                const frameInfo = timeframeInfo[selectedTimeframe];
                // í†µí™”ë³„ ê°€ê²© í¬ë§·íŒ…
                const formatPrice = (price) => {
                    if (currentCoin.currency === 'USD') {
                        // ë¯¸êµ­ ì£¼ì‹: ë‹¬ëŸ¬ ë‹¨ìœ„
                        return `$${price.toFixed(2)}`;
                    } else {
                        // ì•”í˜¸í™”í: ì›í™” ë‹¨ìœ„ (ì–µ/ë§Œ ë³€í™˜)
                    if (price >= 100000000) { // 1ì–µ ì´ìƒ
                        return `${(price/100000000).toFixed(2)}ì–µì›`;
                    } else if (price >= 10000) { // 1ë§Œ ì´ìƒ
                        return `${(price/10000).toFixed(0)}ë§Œì›`;
                    } else {
                        return `${price}ì›`;
                        }
                    }
                };

                // ì‚¬ìš©ì ì§€ì¹¨ ê°€ì ¸ì˜¤ê¸°
                const guidanceInput = document.getElementById('guidanceInput');
                const userGuidance = guidanceInput ? guidanceInput.value.trim() : '';
                
                // ì§€ì¹¨ì´ ìˆìœ¼ë©´ í¬í•¨, ì—†ìœ¼ë©´ ê¸°ë³¸ ë¶„ì„
                const guidanceSection = userGuidance ? 
                    `\nğŸ¯ ë¶„ì„ ì§€ì¹¨: ${userGuidance}\n` : 
                    '\nğŸ¯ ë¶„ì„ ì§€ì¹¨: ì¢…í•©ì ì´ê³  ê°ê´€ì ì¸ ê¸°ìˆ ì  ë¶„ì„ì„ ì œê³µí•´ì£¼ì„¸ìš”.\n';

                // ë‹µë³€ í˜•ì‹ ì„¤ì • (í†µí™”ë³„)
                const priceFormat = currentCoin.currency === 'USD' ? '$XXX.XX' : 'X.XXì–µì›';

                const prompt = `${currentCoin.name}(${currentCoin.symbol}) ${frameInfo.name} ì™„ì „ ê¸°ìˆ ì  ë¶„ì„:

ğŸ’° í˜„ì¬ ì‹œì¥ ìƒí™©:
í˜„ì¬ê°€ê²©: ${formatPrice(currentPrice)}
ì „ì¼ ëŒ€ë¹„: ${priceChange}%
ê±°ë˜ëŸ‰ ì¦ê°: ${recentVolumes.length > 1 ? ((recentVolumes[recentVolumes.length-1] / recentVolumes[recentVolumes.length-2] - 1) * 100).toFixed(1) + '%' : 'N/A'}

ğŸ“Š ê¸°ë³¸ ì§€í‘œ:
RSI (14): ${currentRSI?.toFixed(1)} (${currentRSI < 30 ? 'ê³¼ë§¤ë„' : currentRSI > 70 ? 'ê³¼ë§¤ìˆ˜' : 'ì¤‘ë¦½'})
MACD: ${currentMACD?.toFixed(0)} (${currentMACD > 0 ? 'ìƒìŠ¹ ëª¨ë©˜í…€' : 'í•˜ë½ ëª¨ë©˜í…€'})
ATR ë³€ë™ì„±: ${currentATR?.toFixed(0)}

ğŸ“ˆ ì´ë™í‰ê·  ë¶„ì„:
MA5: ${formatPrice(ma5[ma5.length-1])}
MA20: ${formatPrice(ma20[ma20.length-1])} (ê´´ë¦¬ìœ¨: ${maDistance}%)
MA60: ${formatPrice(ma60[ma60.length-1])}
ì´í‰ì„  ë°°ì—´: ${maStatus}

ğŸ¯ ë³¼ë¦°ì € ë°´ë“œ:
í˜„ì¬ ìœ„ì¹˜: ${bbPosition}
ìƒë‹¨: ${formatPrice(bb.upper[bb.upper.length-1])}
ì¤‘ê°„: ${formatPrice(bb.middle[bb.middle.length-1])}
í•˜ë‹¨: ${formatPrice(bb.lower[bb.lower.length-1])}

ğŸ“ˆ ìµœê·¼ 15ì¼ ê°€ê²© íŠ¸ë Œë“œ:
ê°€ê²© íë¦„: ${recentPrices.map(p => formatPrice(p)).join(' â†’ ')}
ìµœê³ ê°€: ${formatPrice(Math.max(...recentPrices))}
ìµœì €ê°€: ${formatPrice(Math.min(...recentPrices))}
ê³ ì  ëŒ€ë¹„ í•˜ë½ë¥ : ${(((Math.max(...recentPrices) - currentPrice) / Math.max(...recentPrices)) * 100).toFixed(1)}%
ê°€ê²© ë³€ë™ì„±: ${((Math.max(...recentPrices) - Math.min(...recentPrices)) / Math.min(...recentPrices) * 100).toFixed(1)}%

ğŸ“Š ì¶”ì„¸ ë°©í–¥ì„±:
RSI ì¶”ì„¸ (8ì¼): ${recentRSI.map(r => r?.toFixed(1)).join(' â†’ ')} (${recentRSI[recentRSI.length-1] > recentRSI[0] ? 'ìƒìŠ¹' : 'í•˜ë½'})
MA20 ì¶”ì„¸: ${recentMA20[recentMA20.length-1] > recentMA20[0] ? 'ìƒìŠ¹' : 'í•˜ë½'}
MACD ì¶”ì„¸: ${recentMACD.map(m => m?.toFixed(0)).join(' â†’ ')}${guidanceSection}

ìœ„ ë°ì´í„°ì™€ ì§€ì¹¨ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë‹µë³€:

${userGuidance ? `ğŸ¯ ì§€ì¹¨ ë‹µë³€: ${userGuidance}ì— ëŒ€í•œ êµ¬ì²´ì  ë‹µë³€

` : ''}1. ì¶”ì„¸: (ìƒìŠ¹/í•˜ë½/íš¡ë³´)
2. ì‹ í˜¸: (ë§¤ìˆ˜/ë§¤ë„/ê´€ë§) ì‹ ë¢°ë„ XX%
3. ì§€ì§€ì„ /ì €í•­ì„ : ${priceFormat}, ${priceFormat}
4. ëª©í‘œê°€ ë˜ëŠ” ì†ì ˆê°€: ${priceFormat}
5. ì£¼ì˜ì‚¬í•­: í•œì¤„ ì„¤ëª…

${userGuidance ? 'ì§€ì¹¨ì— ëŒ€í•œ ë‹µë³€ì„ ë§¨ ìœ„ì—, ê¸°ë³¸ ë¶„ì„ì„ ì•„ë˜ì— ì‘ì„±í•˜ì„¸ìš”.' : 'ì´ 5ì¤„ë¡œ ì™„ì„±í•˜ì„¸ìš”.'}`;

                let response, data;
                
                if (USE_PROXY_SERVER) {
                    // í”„ë¡ì‹œ ì„œë²„ ì‚¬ìš©
                    // Express ì„œë²„: /api/gpt/analyze
                    // Vercel Functions: /api/gpt
                    const endpoint = PROXY_SERVER_URL.includes('localhost') ? '/api/gpt/analyze' : '/api/gpt';
                    const url = PROXY_SERVER_URL ? `${PROXY_SERVER_URL}${endpoint}` : endpoint;
                    
                    response = await fetch(url, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ prompt })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `í”„ë¡ì‹œ ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                    }
                    
                    data = await response.json();
                    return data.analysis;
                    
                } else {
                    // ì§ì ‘ OpenAI API ì‚¬ìš©
                    response = await fetch("https://api.openai.com/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${OPENAI_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: "gpt-3.5-turbo",
                            messages: [{role: "user", content: prompt}],
                            max_tokens: 600,
                            temperature: 0.3
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
                    }
                    
                    data = await response.json();
                    
                    // ì‘ë‹µì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
                    let analysis = data.choices[0].message.content.trim();
                    
                    // ì‘ë‹µì´ ë„ˆë¬´ ì§§ê±°ë‚˜ ì¤‘ê°„ì— ëŠì–´ì§„ ê²½ìš° í‘œì‹œ
                    if (data.choices[0].finish_reason === 'length') {
                        analysis += "\n\nâš ï¸ ì‘ë‹µì´ ê¸¸ì–´ì„œ ì¼ë¶€ê°€ ì˜ë ¸ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                    }
                    
                    return analysis;
                }
                
            } catch (error) {
                console.error('GPT API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                return `âŒ AI ë¶„ì„ ì˜¤ë¥˜: ${error.message}. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`;
            }
        }
        
        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë° ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        async function draw() {
            try {
                document.getElementById('status').textContent = 'ê³ ê¸‰ ë¶„ì„ ì¤‘...';
                
                const currentCoin = coinInfo[selectedCoin];
                const timeframeConfig = timeframeInfo[selectedTimeframe];
                
                let candleData, reversedData;
                
                if (currentCoin.type === 'crypto') {
                    // ì•”í˜¸í™”í: ì—…ë¹„íŠ¸ API ì‚¬ìš©
                const response = await fetch(`https://api.upbit.com/v1/candles/${timeframeConfig.apiPath}?market=${currentCoin.market}&count=200`);
                if (!response.ok) throw new Error('ì—…ë¹„íŠ¸ API í˜¸ì¶œ ì‹¤íŒ¨');
                
                    candleData = await response.json();
                    reversedData = candleData.reverse(); // ì‹œê°„ìˆœ ì •ë ¬
                } else if (currentCoin.type === 'stock') {
                    // ë¯¸êµ­ ì£¼ì‹: Yahoo Finance API ì‚¬ìš© (ë¬´ë£Œ, API í‚¤ ë¶ˆí•„ìš”)
                    const period1 = Math.floor(Date.now() / 1000) - (200 * 24 * 60 * 60); // 200ì¼ ì „
                    const period2 = Math.floor(Date.now() / 1000); // í˜„ì¬
                    
                    const interval = selectedTimeframe === '5m' ? '5m' : 
                                   selectedTimeframe === '1h' ? '1h' : '1d';
                    
                    // ë¬´ë£Œ ì‹¤ì‹œê°„ ì£¼ì‹ API ì‚¬ìš© (Alpha Vantage ëŒ€ì•ˆ)
                    // CORS ìš°íšŒë¥¼ ìœ„í•œ AllOrigins í”„ë¡ì‹œ ì‚¬ìš©
                    const proxyUrl = 'https://api.allorigins.win/get?url=';
                    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${currentCoin.symbol}?period1=${period1}&period2=${period2}&interval=${interval}`;
                    const apiUrl = proxyUrl + encodeURIComponent(yahooUrl);
                    
                    try {
                        console.log(`ğŸ“¡ ë¯¸êµ­ ì£¼ì‹ ${currentCoin.symbol} ì‹¤ì‹œê°„ ë°ì´í„° ìš”ì²­ ì¤‘...`);
                        const response = await fetch(apiUrl);
                        
                        if (!response.ok) throw new Error('í”„ë¡ì‹œ API í˜¸ì¶œ ì‹¤íŒ¨');
                        
                        const proxyData = await response.json();
                        const stockData = JSON.parse(proxyData.contents);
                        
                        if (!stockData.chart || !stockData.chart.result || !stockData.chart.result[0]) {
                            throw new Error('ì£¼ì‹ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }
                        
                        const result = stockData.chart.result[0];
                        const timestamps = result.timestamp;
                        const quote = result.indicators.quote[0];
                        
                        reversedData = timestamps.map((timestamp, index) => ({
                            candle_date_time_kst: new Date(timestamp * 1000).toISOString(),
                            trade_price: quote.close[index] || 0,
                            high_price: quote.high[index] || 0,
                            low_price: quote.low[index] || 0,
                            opening_price: quote.open[index] || 0,
                            candle_acc_trade_volume: quote.volume[index] || 0
                        })).filter(item => item.trade_price > 0);
                        
                        console.log(`âœ… ${currentCoin.symbol} Yahoo Finance ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ:`, reversedData.length, 'ê°œ ìº”ë“¤');
                        console.log(`ğŸ’° í˜„ì¬ê°€: $${reversedData[reversedData.length-1]?.trade_price?.toFixed(2)}`);
                        
                        // Yahoo Finance ì†ŒìŠ¤ í‘œì‹œ
                        updateDataSourceIndicator('yahoo', currentCoin.symbol);
                        
                    } catch (error) {
                        // ëª¨ë“  API ì‹¤íŒ¨ì‹œ ìµœì‹  ì‹¤ì œ ê°€ê²© ê¸°ë°˜ ëª¨ì˜ ë°ì´í„° ì‚¬ìš©
                        console.warn('ëª¨ë“  ì‹¤ì‹œê°„ ë°ì´í„° API ì‹¤íŒ¨, ìµœì‹  ì‹œì„¸ ê¸°ë°˜ ëª¨ì˜ ë°ì´í„° ì‚¬ìš©:', error);
                        
                        // 2024ë…„ 12ì›” ì‹¤ì œ ì£¼ê°€ ê¸°ì¤€ ì—…ë°ì´íŠ¸ëœ ê°€ê²©
                        const latestBasePrices = {
                            'BTC': 100000000,  // ë¹„íŠ¸ì½”ì¸ (1ì–µì›)
                            'ETH': 4500000,    // ì´ë”ë¦¬ì›€ (450ë§Œì›)
                            'XRP': 3000,       // ì—‘ìŠ¤ì•Œí”¼ (3000ì›)
                            'DOGE': 500,       // ë„ì§€ì½”ì¸ (500ì›)
                            'SOL': 200000,     // ì†”ë¼ë‚˜ (20ë§Œì›)
                            'TRUMP': 50000     // ì˜¤í”¼ì…œíŠ¸ëŸ¼í”„ (5ë§Œì›)
                        };
                        const basePrice = latestBasePrices[currentCoin.symbol] || 150;
                        
                        // ì‹¤ì œ ê°€ê²© ì›€ì§ì„ê³¼ ìœ ì‚¬í•œ íŒ¨í„´ ìƒì„±
                        reversedData = Array.from({length: 200}, (_, i) => {
                            // í˜„ì‹¤ì ì¸ ê°€ê²© ë³€ë™ íŒ¨í„´ (ì‹¤ì œ ì£¼ì‹ì²˜ëŸ¼)
                            const trend = Math.sin(i * 0.02) * 0.1; // ì¥ê¸° íŠ¸ë Œë“œ
                            const noise = (Math.random() - 0.5) * 0.03; // ë…¸ì´ì¦ˆ
                            const volatility = Math.sin(i * 0.1) * 0.02; // ë³€ë™ì„±
                            
                            const priceMultiplier = 1 + trend + noise + volatility;
                            const price = basePrice * priceMultiplier;
                            
                            return {
                                candle_date_time_kst: new Date(Date.now() - (200 - i) * 24 * 60 * 60 * 1000).toISOString(),
                                trade_price: Math.max(price * 0.5, price), // ìµœì†Œê°’ ë³´ì¥
                                high_price: price * (1 + Math.random() * 0.02),
                                low_price: price * (1 - Math.random() * 0.02),
                                opening_price: price * (0.995 + Math.random() * 0.01),
                                candle_acc_trade_volume: Math.floor(Math.random() * 2000000 + 500000)
                            };
                        });
                        
                        console.log(`ğŸ“Š ${currentCoin.symbol} ëª¨ì˜ ë°ì´í„° ìƒì„± ì™„ë£Œ (ê¸°ì¤€ê°€: $${basePrice})`);
                        
                        // ëª¨ì˜ ë°ì´í„° ì†ŒìŠ¤ í‘œì‹œ
                        updateDataSourceIndicator('mock', currentCoin.symbol);
                    }
                }
                
                // ì‹œê°„ í”„ë ˆì„ì— ë”°ë¥¸ ë¼ë²¨ í¬ë§· ì„¤ì •
                const labels = reversedData.map(item => {
                    const date = new Date(item.candle_date_time_kst);
                    
                    switch(selectedTimeframe) {
                        case '5m':
                        case '1h':
                            // ë¶„ë´‰, ì‹œê°„ë´‰: ì‹œê°„ í‘œì‹œ
                            return date.toLocaleTimeString('ko-KR', { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                            });
                        case '1d':
                            // ì¼ë´‰: ì›”/ì¼ í‘œì‹œ
                            return date.toLocaleDateString('ko-KR', { 
                                month: 'short', 
                                day: 'numeric' 
                            });
                        case '1w':
                            // ì£¼ë´‰: ì›”/ì¼ í‘œì‹œ
                            return date.toLocaleDateString('ko-KR', { 
                                month: 'short', 
                                day: 'numeric' 
                            });
                        default:
                            return date.toLocaleTimeString('ko-KR', { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                            });
                    }
                });
                
                const prices = reversedData.map(item => item.trade_price);
                const highs = reversedData.map(item => item.high_price);
                const lows = reversedData.map(item => item.low_price);
                const volumes = reversedData.map(item => item.candle_acc_trade_volume);
                const closes = prices;
                
                // ëª¨ë“  ê¸°ìˆ ì  ì§€í‘œ ê³„ì‚°
                const rsi = calculateRSI(closes);
                const ma5 = calculateMA(closes, 5);
                const ma20 = calculateMA(closes, 20);
                const ma60 = calculateMA(closes, 60);
                const macd = calculateMACD(closes);
                const bb = calculateBollingerBands(closes);
                const atr = calculateATR(highs, lows, closes);
                const divergenceRate = calculateDivergenceRate(closes, ma20);
                const divergence = detectDivergence(closes, rsi);
                
                // ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
                chart.data.labels = labels;
                
                // ê°€ê²© ë°ì´í„° (ì¢…ê°€, ê³ ê°€, ì €ê°€)
                chart.data.datasets[0].data = prices; // ì¢…ê°€
                chart.data.datasets[1].data = highs;  // ê³ ê°€  
                chart.data.datasets[2].data = lows;   // ì €ê°€

                // ì´ë™í‰ê· ì„  ë°ì´í„°
                chart.data.datasets[3].data = ma5.length > 0 ? 
                    Array(prices.length - ma5.length).fill(null).concat(ma5) : [];
                chart.data.datasets[4].data = ma20.length > 0 ? 
                    Array(prices.length - ma20.length).fill(null).concat(ma20) : [];
                chart.data.datasets[5].data = ma60.length > 0 ? 
                    Array(prices.length - ma60.length).fill(null).concat(ma60) : [];

                // ë³¼ë¦°ì € ë°´ë“œ ë°ì´í„°
                chart.data.datasets[6].data = bb.upper.length > 0 ? 
                    Array(prices.length - bb.upper.length).fill(null).concat(bb.upper) : [];
                chart.data.datasets[7].data = bb.lower.length > 0 ? 
                    Array(prices.length - bb.lower.length).fill(null).concat(bb.lower) : [];

                // ê±°ë˜ëŸ‰ ë°ì´í„° (ì‹¤ì œ ê±°ë˜ëŸ‰ í‘œì‹œ)
                if (volumes && volumes.length > 0) {
                    // ì£¼ì‹ì˜ ê²½ìš° ê±°ë˜ëŸ‰ì´ ë§¤ìš° í´ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì ì ˆíˆ ìŠ¤ì¼€ì¼ë§
                    if (currentCoin.type === 'stock') {
                        chart.data.datasets[8].data = volumes;
                    } else {
                        // ì•”í˜¸í™”íì˜ ê²½ìš° ê¸°ì¡´ ë°©ì‹ ìœ ì§€
                        chart.data.datasets[8].data = volumes;
                    }
                } else {
                    chart.data.datasets[8].data = [];
                }

                // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                chart.update();
                
                // í˜„ì¬ ê°’ë“¤
                const currentPrice = prices[prices.length - 1];
                const currentRSI = rsi[rsi.length - 1];
                const currentMACD = macd.macd[macd.macd.length - 1];
                const currentATR = atr[atr.length - 1];
                const currentDivergenceRate = divergenceRate[divergenceRate.length - 1];
                
                // ì´í‰ì„  ë°°ì—´ ìƒíƒœ
                const ma5Current = ma5[ma5.length - 1];
                const ma20Current = ma20[ma20.length - 1];
                const ma60Current = ma60[ma60.length - 1];
                let maStatus = 'ì •ë°°ì—´';
                if (ma5Current && ma20Current && ma60Current) {
                    if (ma5Current > ma20Current && ma20Current > ma60Current) {
                        maStatus = 'ğŸŸ¢ ì •ë°°ì—´';
                    } else if (ma5Current < ma20Current && ma20Current < ma60Current) {
                        maStatus = 'ğŸ”´ ì—­ë°°ì—´';
                    } else {
                        maStatus = 'ğŸŸ¡ í˜¼ì¬';
                    }
                }
                
                // ë³¼ë¦°ì € ë°´ë“œ ìœ„ì¹˜
                let bbPosition = '-';
                if (bb.upper.length > 0 && bb.lower.length > 0) {
                    const upperBand = bb.upper[bb.upper.length - 1];
                    const lowerBand = bb.lower[bb.lower.length - 1];
                    const middleBand = bb.middle[bb.middle.length - 1];
                    
                    if (currentPrice >= upperBand) {
                        bbPosition = 'ğŸ”´ ìƒë‹¨';
                    } else if (currentPrice <= lowerBand) {
                        bbPosition = 'ğŸŸ¢ í•˜ë‹¨';
                    } else if (currentPrice > middleBand) {
                        bbPosition = 'ğŸŸ¡ ìƒë¶€';
                    } else {
                        bbPosition = 'ğŸŸ¡ í•˜ë¶€';
                    }
                }
                
                // UI ì—…ë°ì´íŠ¸
                const priceSymbol = currentCoin.currency === 'USD' ? '$' : 'â‚©';
                document.getElementById('currentPrice').textContent = 
                    currentPrice ? `${priceSymbol}${currentPrice.toLocaleString()}` : 'ë¡œë”© ì¤‘...';
                
                document.getElementById('rsiValue').textContent = 
                    currentRSI ? currentRSI.toFixed(2) : '-';
                
                document.getElementById('macdValue').textContent = 
                    currentMACD ? currentMACD.toFixed(0) : '-';
                
                document.getElementById('bbValue').textContent = bbPosition;
                
                document.getElementById('atrValue').textContent = 
                    currentATR ? currentATR.toFixed(0) : '-';
                
                document.getElementById('divergenceValue').textContent = 
                    currentDivergenceRate ? currentDivergenceRate.toFixed(1) + '%' : '-';
                
                document.getElementById('maStatus').textContent = maStatus;
                
                // ê³ ê¸‰ ì‹ í˜¸ ë¶„ì„
                const analysisData = {
                    price: currentPrice,
                    prices: closes,
                    rsi: currentRSI,
                    ma5: ma5,
                    ma20: ma20,
                    ma60: ma60,
                    macd: macd,
                    bb: bb,
                    volumes: volumes,
                    atr: atr,
                    divergenceRate: divergenceRate,
                    divergence: divergence
                };
                
                const analysis = analyzeAdvancedSignal(analysisData);
                const signalElement = document.getElementById('signal');
                signalElement.textContent = analysis.signal;
                signalElement.className = 'signal-display signal-' + 
                    (analysis.signal === 'ë§¤ìˆ˜' ? 'buy' : 
                     analysis.signal === 'ë§¤ë„' ? 'sell' : 'hold');
                
                document.getElementById('confidence').textContent = analysis.confidence;
                
                // ì‹ í˜¸ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                const signalListElement = document.getElementById('signalList');
                if (analysis.signals.length > 0) {
                    signalListElement.innerHTML = analysis.signals.join('<br>');
                } else {
                    signalListElement.textContent = 'í˜„ì¬ ëª…í™•í•œ ì‹ í˜¸ ì—†ìŒ';
                }
                
                // í˜„ì¬ ì„ íƒëœ ì¢…ëª©ì˜ ë²„íŠ¼ ì‹ í˜¸ í…ìŠ¤íŠ¸ë¥¼ ì¦‰ì‹œ ë™ê¸°í™”
                updateCurrentCoinButtonColor(analysis);
                
                // ê°•ì œ ë²„íŠ¼ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ì¶”ê°€ ë³´ì¥)
                if (analysis.signal && analysis.confidence) {
                    setTimeout(() => {
                        forceUpdateButtonColor(selectedCoin, analysis);
                    }, 100);
                }
                
                // ìµœì‹  ë°ì´í„°ë¥¼ GPT ë¶„ì„ìš©ìœ¼ë¡œ ì €ì¥
                latestAnalysisData = {
                    closes: closes,
                    highs: highs,
                    lows: lows,
                    rsi: rsi,
                    macd: macd,
                    ma5: ma5,
                    ma20: ma20,
                    ma60: ma60,
                    bb: bb,
                    volumes: volumes,
                    atr: atr,
                    divergenceRate: divergenceRate,
                    divergence: divergence,
                    currentPrice: currentPrice,
                    currentRSI: currentRSI,
                    currentMACD: currentMACD,
                    currentATR: currentATR,
                    currentDivergenceRate: currentDivergenceRate,
                    maStatus: maStatus,
                    bbPosition: bbPosition
                };
                
                const currentTf = timeframeInfo[selectedTimeframe];
                document.getElementById('status').textContent = 
                    `ë§ˆì§€ë§‰ ${currentTf.name} ë¶„ì„: ${new Date().toLocaleTimeString('ko-KR')} (${autoUpdate ? 'ìë™' : 'ìˆ˜ë™'})`;
                
            } catch (error) {
                console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                document.getElementById('status').textContent = `ì˜¤ë¥˜: ${error.message}`;
            }
        }
        
        // GPT ë¶„ì„ ìˆ˜ë™ ì‹¤í–‰ í•¨ìˆ˜
        async function requestGPTAnalysis() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const gptSignalDiv = document.getElementById('gptSignal');
            
            // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¨¼ì € ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ì•ˆë‚´
            if (!latestAnalysisData.closes || latestAnalysisData.closes.length === 0) {
                gptSignalDiv.innerHTML = 'âš ï¸ <strong>ë¨¼ì € ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”!</strong><br><br>ğŸ“Š "ìˆ˜ë™ ê°±ì‹ " ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                return;
            }
            
            try {
                // ë²„íŠ¼ ë¹„í™œì„±í™”
                analyzeBtn.disabled = true;
                analyzeBtn.innerHTML = '<span class="loading"></span><span>ë¶„ì„ ì¤‘...</span>';
                
                // GPT ë¶„ì„ ì‹œì‘ ë©”ì‹œì§€
                gptSignalDiv.innerHTML = 'ğŸ¤– <strong>AIê°€ ê³ ê¸‰ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</strong><br><br><span class="loading"></span> GPT-3.5ê°€ ìµœì‹  ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...<br>ğŸ“Š 15ê°œ ê°€ê²© ë°ì´í„° + 8ê°œ ê¸°ìˆ  ì§€í‘œ ì¢…í•© ë¶„ì„ ì¤‘';
                
                // GPT API í˜¸ì¶œ (ì „ì²´ ë¶„ì„ ë°ì´í„° ì „ë‹¬)
                const gptAnalysis = await getGPTSignal(latestAnalysisData);
                
                // ê²°ê³¼ í‘œì‹œ
                gptSignalDiv.innerHTML = gptAnalysis.replace(/\n/g, '<br>');
                
                // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<span>ğŸ”</span><span>ë¶„ì„</span>';
                
            } catch (error) {
                console.error('GPT ë¶„ì„ ì˜¤ë¥˜:', error);
                gptSignalDiv.innerHTML = `âŒ <strong>ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</strong><br><br>ğŸ”§ ì˜¤ë¥˜ ë‚´ìš©: ${error.message}<br><br>ğŸ’¡ API í‚¤ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
                
                // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<span>ğŸ”</span><span>ë¶„ì„</span>';
            }
        }
        
        // ìë™ ì—…ë°ì´íŠ¸ í† ê¸€
        function toggleAutoUpdate() {
            autoUpdate = !autoUpdate;
            
            if (autoUpdate) {
                const tfInfo = timeframeInfo[selectedTimeframe];
                updateInterval = setInterval(draw, tfInfo.updateInterval);
                document.getElementById('status').textContent += ' (ìë™ ê°±ì‹  ON)';
            } else {
                clearInterval(updateInterval);
                document.getElementById('status').textContent += ' (ìë™ ê°±ì‹  OFF)';
            }
        }
        
        // ì‹ í˜¸ ê°•ë„ë³„ CSS í´ë˜ìŠ¤ ë°˜í™˜
        function getSignalClass(signal, confidence) {
            if (signal === 'ë§¤ìˆ˜') {
                if (confidence >= 80) return 'signal-strong-buy';
                else if (confidence >= 70) return 'signal-buy';
                else return 'signal-weak-buy';
            } else if (signal === 'ë§¤ë„') {
                if (confidence >= 80) return 'signal-strong-sell';
                else if (confidence >= 70) return 'signal-sell';
                else return 'signal-weak-sell';
            } else {
                return 'signal-hold';
            }
        }
        
        // ì¢…ëª©ë³„ ì‹ í˜¸ ë¶„ì„ (ê°„ì†Œí™”ëœ ë²„ì „)
        async function analyzeSymbolSignal(symbol) {
            try {
                const coin = coinInfo[symbol];
                if (!coin) return { signal: 'ê´€ë§', confidence: 50 };
                
                let response, data;
                
                if (coin.type === 'crypto') {
                    // ì•”í˜¸í™”í: ì—…ë¹„íŠ¸ API
                    response = await fetch(`https://api.upbit.com/v1/candles/days?market=${coin.market}&count=50`);
                    if (!response.ok) throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨');
                    data = await response.json();
                    data = data.reverse();
                } else {
                                         // ì£¼ì‹: 2024ë…„ 12ì›” ì‹¤ì œ ì‹œì„¸ ê¸°ë°˜ ëª¨ì˜ ë°ì´í„°
                     const basePrices = {
                                         'XRP': 3000, 'DOGE': 500, 'SOL': 200000, 'TRUMP': 50000
                     };
                    const basePrice = basePrices[symbol] || 150;
                    
                    data = Array.from({length: 50}, (_, i) => ({
                        trade_price: basePrice + Math.sin(i * 0.1) * 20 + Math.random() * 10,
                        high_price: 0, low_price: 0,
                        candle_acc_trade_volume: Math.floor(Math.random() * 1000000)
                    }));
                    
                    data.forEach(item => {
                        item.high_price = item.trade_price * 1.02;
                        item.low_price = item.trade_price * 0.98;
                    });
                }
                
                const prices = data.map(item => item.trade_price);
                const highs = data.map(item => item.high_price);
                const lows = data.map(item => item.low_price);
                const volumes = data.map(item => item.candle_acc_trade_volume);
                
                // ê¸°ìˆ ì  ì§€í‘œ ê³„ì‚°
                const rsi = calculateRSI(prices);
                const ma5 = calculateMA(prices, 5);
                const ma20 = calculateMA(prices, 20);
                const ma60 = calculateMA(prices, 60);
                const macd = calculateMACD(prices);
                const bb = calculateBollingerBands(prices);
                const atr = calculateATR(highs, lows, prices);
                const divergenceRate = calculateDivergenceRate(prices, ma20);
                const divergence = detectDivergence(prices, rsi);
                
                // ì‹ í˜¸ ë¶„ì„
                const analysisData = {
                    price: prices[prices.length - 1],
                    prices: prices,
                    rsi: rsi[rsi.length - 1],
                    ma5: ma5,
                    ma20: ma20,
                    ma60: ma60,
                    macd: macd,
                    bb: bb,
                    volumes: volumes,
                    atr: atr,
                    divergenceRate: divergenceRate,
                    divergence: divergence
                };
                
                return analyzeAdvancedSignal(analysisData);
                
            } catch (error) {
                console.warn(`${symbol} ì‹ í˜¸ ë¶„ì„ ì‹¤íŒ¨:`, error);
                return { signal: 'ê´€ë§', confidence: 50 };
            }
        }
        
        // í˜„ì¬ ì„ íƒëœ ì¢…ëª© ë²„íŠ¼ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
        function updateCurrentCoinButtonColor(analysis) {
            const btn = document.querySelector(`[data-coin="${selectedCoin}"]`);
            
            if (btn && analysis) {
                // ê¸°ì¡´ ì‹ í˜¸ í´ë˜ìŠ¤ ì œê±°
                btn.classList.remove('signal-strong-buy', 'signal-buy', 'signal-weak-buy', 
                                   'signal-hold', 'signal-weak-sell', 'signal-sell', 'signal-strong-sell');
                
                // ìƒˆë¡œìš´ ì‹ í˜¸ í´ë˜ìŠ¤ ì¶”ê°€ (CSSì—ì„œ ìë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ í‘œì‹œ)
                const signalClass = getSignalClass(analysis.signal, analysis.confidence);
                btn.classList.add(signalClass);
                
                // íˆ´íŒì— ì‹ í˜¸ ì •ë³´ ì¶”ê°€
                const originalTitle = btn.getAttribute('data-original-tooltip') || btn.title || '';
                const signalInfo = `\n\nğŸ“Š í˜„ì¬ ì‹ í˜¸: ${analysis.signal} (${analysis.confidence}%)`;
                btn.title = originalTitle.replace(/\n\nğŸ“Š í˜„ì¬ ì‹ í˜¸:.*/, '') + signalInfo;
                
                if (!btn.getAttribute('data-original-tooltip')) {
                    btn.setAttribute('data-original-tooltip', originalTitle);
                }
                
                console.log(`âœ… ${selectedCoin} ë²„íŠ¼ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸: ${analysis.signal} (${analysis.confidence}%)`);
            }
        }
        
        // ëª¨ë“  ì¢…ëª©ì˜ ë²„íŠ¼ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (í˜„ì¬ ì„ íƒëœ ì¢…ëª© ì œì™¸)
        async function updateAllSignalColors() {
            const symbols = Object.keys(coinInfo).filter(symbol => symbol !== selectedCoin);
            
            for (const symbol of symbols) {
                try {
                    const analysis = await analyzeSymbolSignal(symbol);
                    const btn = document.querySelector(`[data-coin="${symbol}"]`);
                    
                    if (btn) {
                        // ê¸°ì¡´ ì‹ í˜¸ í´ë˜ìŠ¤ ì œê±°
                        btn.classList.remove('signal-strong-buy', 'signal-buy', 'signal-weak-buy', 
                                           'signal-hold', 'signal-weak-sell', 'signal-sell', 'signal-strong-sell');
                        
                        // ìƒˆë¡œìš´ ì‹ í˜¸ í´ë˜ìŠ¤ ì¶”ê°€ (CSSì—ì„œ ìë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ í‘œì‹œ)
                        const signalClass = getSignalClass(analysis.signal, analysis.confidence);
                        btn.classList.add(signalClass);
                        
                        // íˆ´íŒì— ì‹ í˜¸ ì •ë³´ ì¶”ê°€
                        const originalTitle = btn.getAttribute('data-original-tooltip') || btn.title || '';
                        const signalInfo = `\n\nğŸ“Š í˜„ì¬ ì‹ í˜¸: ${analysis.signal} (${analysis.confidence}%)`;
                        btn.title = originalTitle.replace(/\n\nğŸ“Š í˜„ì¬ ì‹ í˜¸:.*/, '') + signalInfo;
                        
                        if (!btn.getAttribute('data-original-tooltip')) {
                            btn.setAttribute('data-original-tooltip', originalTitle);
                        }
                    }
                    
                    // API í˜¸ì¶œ ê°„ê²©ì„ ë‘ì–´ ê³¼ë¶€í•˜ ë°©ì§€
                    await new Promise(resolve => setTimeout(resolve, 200));
                    
                } catch (error) {
                    console.warn(`${symbol} ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`, error);
                }
            }
            
            console.log('âœ… ëª¨ë“  ì¢…ëª© ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }
        
        // ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ê°„ê²© (5ë¶„ë§ˆë‹¤)
        let signalUpdateInterval;
        
        // API í‚¤ ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function openApiModal() {
            document.getElementById('apiModal').style.display = 'block';
            
            // ì €ì¥ëœ API í‚¤ê°€ ìˆìœ¼ë©´ í‘œì‹œ (ë§ˆìŠ¤í‚¹)
            const savedKey = localStorage.getItem('openai_api_key');
            if (savedKey) {
                document.getElementById('apiKeyInput').value = savedKey;
            }
        }
        
        function closeApiModal() {
            document.getElementById('apiModal').style.display = 'none';
        }
        
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const statusDiv = document.getElementById('apiStatus');
            
            if (!apiKey) {
                showApiStatus('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // OpenAI API í‚¤ í˜•ì‹ ê²€ì¦
            const validPrefix = 's' + 'k' + '-';
            if (!apiKey.startsWith(validPrefix)) {
                showApiStatus('ì˜¬ë°”ë¥¸ OpenAI API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.', 'error');
                return;
            }
            
            // API í‚¤ ì €ì¥
            localStorage.setItem('openai_api_key', apiKey);
            OPENAI_API_KEY = apiKey;
            
            showApiStatus('âœ… API í‚¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            updateApiKeyButtonStatus();
        }
        
        async function testApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                showApiStatus('í…ŒìŠ¤íŠ¸í•  API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            showApiStatus('ğŸ” API í‚¤ë¥¼ í…ŒìŠ¤íŠ¸ ì¤‘ì…ë‹ˆë‹¤...', 'success');
            
            try {
                const response = await fetch("https://api.openai.com/v1/models", {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`
                    }
                });
                
                if (response.ok) {
                    showApiStatus('âœ… API í‚¤ê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!', 'success');
                } else {
                    showApiStatus('âŒ API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                }
            } catch (error) {
                showApiStatus('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        function clearApiKey() {
            if (confirm('ì €ì¥ëœ API í‚¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('openai_api_key');
                OPENAI_API_KEY = "";
                document.getElementById('apiKeyInput').value = '';
                showApiStatus('ğŸ—‘ï¸ API í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                updateApiKeyButtonStatus();
            }
        }
        
        function showApiStatus(message, type) {
            const statusDiv = document.getElementById('apiStatus');
            statusDiv.textContent = message;
            statusDiv.className = `api-status ${type}`;
            statusDiv.style.display = 'block';
        }
        
        function loadApiKey() {
            const savedKey = localStorage.getItem('openai_api_key');
            if (savedKey) {
                OPENAI_API_KEY = savedKey;
                updateApiKeyButtonStatus();
            }
        }
        
        function updateApiKeyButtonStatus() {
            const btn = document.getElementById('apiKeyBtn');
            if (OPENAI_API_KEY) {
                btn.textContent = 'ğŸ”‘ API í‚¤ ì„¤ì •ë¨';
                btn.classList.add('configured');
            } else {
                btn.textContent = 'ğŸ”‘ API í‚¤ ì„¤ì •';
                btn.classList.remove('configured');
            }
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('apiModal');
            if (event.target === modal) {
                closeApiModal();
            }
        }
        
        // ì´ˆê¸°í™”
        window.onload = function() {
            loadApiKey(); // API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
            initChart();
            draw();
            
            // ìë™ ì—…ë°ì´íŠ¸ ì‹œì‘ (ì„ íƒëœ ì‹œê°„ í”„ë ˆì„ì— ë”°ë¼)
            const tfInfo = timeframeInfo[selectedTimeframe];
            updateInterval = setInterval(draw, tfInfo.updateInterval);
            
            // ì‹ í˜¸ í…ìŠ¤íŠ¸ ì´ˆê¸° ì—…ë°ì´íŠ¸ (3ì´ˆ í›„ ì‹œì‘)
            setTimeout(() => {
                updateAllSignalColors();
                // 5ë¶„ë§ˆë‹¤ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                signalUpdateInterval = setInterval(updateAllSignalColors, 5 * 60 * 1000);
            }, 3000);
        };

        // Alpha Vantage API í‚¤ ì„¤ì •
        let ALPHA_VANTAGE_API_KEY = localStorage.getItem('alphaVantageApiKey') || '';

        // API í‚¤ ì„¤ì • ëª¨ë‹¬ì— Alpha Vantage ì¶”ê°€
        function showApiModal() {
            const modal = document.getElementById('apiModal');
            const content = modal.querySelector('.api-modal-content');
            
            content.innerHTML = `
                <span class="close" onclick="closeApiModal()">&times;</span>
                <h2>ğŸ”‘ API í‚¤ ì„¤ì •</h2>
                
                <div class="api-section">
                    <h3>ğŸ¤– OpenAI (AI ë¶„ì„ìš©)</h3>
                    <input type="password" id="apiKeyInput" placeholder="sk-..." 
                           value="${OPENAI_API_KEY}" style="width: 100%; padding: 10px; margin: 10px 0;">
                    <p style="color: #ccc; font-size: 0.9em;">AI ë¶„ì„ ê¸°ëŠ¥ì„ ìœ„í•œ OpenAI API í‚¤</p>
                </div>
                
                <div class="api-section">
                    <h3>ğŸ“ˆ Alpha Vantage (ë¯¸êµ­ ì£¼ì‹ ì‹¤ì‹œê°„ ë°ì´í„°)</h3>
                    <input type="password" id="alphaVantageKeyInput" placeholder="YOUR_API_KEY" 
                           value="${ALPHA_VANTAGE_API_KEY}" style="width: 100%; padding: 10px; margin: 10px 0;">
                    <p style="color: #ccc; font-size: 0.9em;">
                        ë¬´ë£Œ API í‚¤: <a href="https://www.alphavantage.co/support/#api-key" target="_blank" style="color: #4CAF50;">ì—¬ê¸°ì„œ ë°œê¸‰</a> (ì›” 25íšŒ ë¬´ë£Œ)
                    </p>
                </div>
                
                <button onclick="saveApiKeys()" 
                        style="background: #4CAF50; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; width: 100%; margin: 10px 0;">
                    ğŸ’¾ ì €ì¥
                </button>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 5px;">
                    <h4>ğŸ¯ ì¶”ì²œ ì„¤ì •:</h4>
                    <ul style="color: #ccc; text-align: left;">
                        <li><strong>OpenAI</strong>: AI ê¸°ìˆ ì  ë¶„ì„ (GPT-3.5)</li>
                        <li><strong>Alpha Vantage</strong>: ì‹¤ì œ ë¯¸êµ­ ì£¼ì‹ ì‹¤ì‹œê°„ ë°ì´í„°</li>
                        <li>ëª¨ë‘ ë¬´ë£Œ í”Œëœìœ¼ë¡œ ì‹œì‘ ê°€ëŠ¥</li>
                    </ul>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function saveApiKeys() {
            const openaiKey = document.getElementById('apiKeyInput').value.trim();
            const alphaVantageKey = document.getElementById('alphaVantageKeyInput').value.trim();
            
            if (openaiKey) {
                OPENAI_API_KEY = openaiKey;
                localStorage.setItem('openaiApiKey', openaiKey);
            }
            
            if (alphaVantageKey) {
                ALPHA_VANTAGE_API_KEY = alphaVantageKey;
                localStorage.setItem('alphaVantageApiKey', alphaVantageKey);
            }
            
            closeApiModal();
            
            // ì„±ê³µ ë©”ì‹œì§€
            const statusEl = document.getElementById('status');
            if (statusEl) {
                statusEl.innerHTML = 'âœ… API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!';
                setTimeout(() => {
                    statusEl.innerHTML = 'ì¤€ë¹„ ì™„ë£Œ';
                }, 2000);
            }
        }

        // Alpha Vantage APIë¡œ ì‹¤ì œ ë¯¸êµ­ ì£¼ì‹ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchAlphaVantageData(symbol) {
            if (!ALPHA_VANTAGE_API_KEY) {
                throw new Error('Alpha Vantage API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }
            
            const apiUrl = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${ALPHA_VANTAGE_API_KEY}&outputsize=compact`;
            
            console.log(`ğŸ“¡ Alpha Vantageë¡œ ${symbol} ì‹¤ì‹œê°„ ë°ì´í„° ìš”ì²­ ì¤‘...`);
            
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('Alpha Vantage API í˜¸ì¶œ ì‹¤íŒ¨');
            
            const data = await response.json();
            
            if (data['Error Message']) {
                throw new Error(`Alpha Vantage ì˜¤ë¥˜: ${data['Error Message']}`);
            }
            
            if (data['Note']) {
                throw new Error('Alpha Vantage API í˜¸ì¶œ í•œë„ ì´ˆê³¼');
            }
            
            const timeSeries = data['Time Series (Daily)'];
            if (!timeSeries) {
                throw new Error('Alpha Vantage ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // ë°ì´í„° ë³€í™˜
            const reversedData = Object.entries(timeSeries)
                .map(([date, values]) => ({
                    candle_date_time_kst: date + 'T00:00:00.000Z',
                    trade_price: parseFloat(values['4. close']),
                    high_price: parseFloat(values['2. high']),
                    low_price: parseFloat(values['3. low']),
                    opening_price: parseFloat(values['1. open']),
                    candle_acc_trade_volume: parseInt(values['5. volume'])
                }))
                .sort((a, b) => new Date(a.candle_date_time_kst) - new Date(b.candle_date_time_kst));
            
            const latestDate = Object.keys(timeSeries)[0]; // ê°€ì¥ ìµœê·¼ ë‚ ì§œ
            console.log(`âœ… ${symbol} Alpha Vantage ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ:`, reversedData.length, 'ê°œ ìº”ë“¤');
            console.log(`ğŸ’° í˜„ì¬ê°€: $${reversedData[reversedData.length-1]?.trade_price?.toFixed(2)}`);
            console.log(`ğŸ“… ìµœì‹  ë°ì´í„° ë‚ ì§œ: ${latestDate} (ET)`);
            
            // ë°ì´í„° ì†ŒìŠ¤ í‘œì‹œ
            updateDataSourceIndicator('alpha_vantage', symbol, latestDate);
            
            return reversedData;
        }

        // ì¶”ê°€ API í‚¤ë“¤
        let TWELVE_DATA_API_KEY = localStorage.getItem('twelveDataApiKey') || '';
        let POLYGON_API_KEY = localStorage.getItem('polygonApiKey') || '';
        let FINNHUB_API_KEY = localStorage.getItem('finnhubApiKey') || '';

        // í™•ì¥ëœ API í‚¤ ì„¤ì • ëª¨ë‹¬
        function showApiModal() {
            const modal = document.getElementById('apiModal');
            const content = modal.querySelector('.api-modal-content');
            
            content.innerHTML = `
                <span class="close" onclick="closeApiModal()">&times;</span>
                <h2>ğŸ”‘ ë‹¤ì–‘í•œ API ì„œë¹„ìŠ¤ ì„¤ì •</h2>
                
                <div class="api-section">
                    <h3>ğŸ¤– OpenAI (AI ë¶„ì„ìš©)</h3>
                    <input type="password" id="apiKeyInput" placeholder="sk-..." 
                           value="${OPENAI_API_KEY}" style="width: 100%; padding: 10px; margin: 10px 0;">
                    <p style="color: #ccc; font-size: 0.9em;">AI ë¶„ì„ ê¸°ëŠ¥ì„ ìœ„í•œ OpenAI API í‚¤</p>
                </div>
                
                <div class="api-section">
                    <h3>ğŸ“ˆ ì£¼ì‹ ë°ì´í„° API (ì„ íƒì‚¬í•­)</h3>
                    
                    <div style="margin: 15px 0;">
                        <label style="color: #4CAF50; font-weight: bold;">Alpha Vantage (ì¶”ì²œ #1)</label>
                        <input type="password" id="alphaVantageKeyInput" placeholder="YOUR_API_KEY" 
                               value="${ALPHA_VANTAGE_API_KEY}" style="width: 100%; padding: 8px; margin: 5px 0;">
                        <small style="color: #999;">ë¬´ë£Œ: 25íšŒ/ì¼ | <a href="https://www.alphavantage.co/support/#api-key" target="_blank" style="color: #4CAF50;">ê°€ì…í•˜ê¸°</a></small>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label style="color: #2196F3; font-weight: bold;">Twelve Data (ì¶”ì²œ #2)</label>
                        <input type="password" id="twelveDataKeyInput" placeholder="YOUR_API_KEY" 
                               value="${TWELVE_DATA_API_KEY}" style="width: 100%; padding: 8px; margin: 5px 0;">
                        <small style="color: #999;">ë¬´ë£Œ: 800íšŒ/ì›” | <a href="https://twelvedata.com/" target="_blank" style="color: #2196F3;">ê°€ì…í•˜ê¸°</a></small>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label style="color: #FF9800; font-weight: bold;">Polygon.io</label>
                        <input type="password" id="polygonKeyInput" placeholder="YOUR_API_KEY" 
                               value="${POLYGON_API_KEY}" style="width: 100%; padding: 8px; margin: 5px 0;">
                        <small style="color: #999;">ë¬´ë£Œ: 1,000íšŒ/ì›” | <a href="https://polygon.io/" target="_blank" style="color: #FF9800;">ê°€ì…í•˜ê¸°</a></small>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <label style="color: #9C27B0; font-weight: bold;">Finnhub</label>
                        <input type="password" id="finnhubKeyInput" placeholder="YOUR_API_KEY" 
                               value="${FINNHUB_API_KEY}" style="width: 100%; padding: 8px; margin: 5px 0;">
                        <small style="color: #999;">ë¬´ë£Œ: 60íšŒ/ì›” | <a href="https://finnhub.io/" target="_blank" style="color: #9C27B0;">ê°€ì…í•˜ê¸°</a></small>
                    </div>
                </div>
                
                <button onclick="saveApiKeys()" 
                        style="background: #4CAF50; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; width: 100%; margin: 10px 0;">
                    ğŸ’¾ ì €ì¥
                </button>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 5px;">
                    <h4>ğŸ¯ ì•”í˜¸í™”í ë¶„ì„ ì‹œìŠ¤í…œ:</h4>
                    <ul style="color: #ccc; text-align: left; font-size: 0.9em;">
                        <li><strong>ì—…ë¹„íŠ¸ API</strong>: ì‹¤ì‹œê°„ ë¹„íŠ¸ì½”ì¸, ì´ë”ë¦¬ì›€ ë°ì´í„°</li>
                        <li><strong>OpenAI GPT</strong>: AI ê¸°ë°˜ ê¸°ìˆ ì  ë¶„ì„</li>
                        <li><strong>13ê°€ì§€ ê¸°ìˆ ì§€í‘œ</strong>: RSI, MACD, ë³¼ë¦°ì €ë°´ë“œ ë“±</li>
                        <li><strong>ì‹¤ì‹œê°„ ì°¨íŠ¸</strong>: 5ë¶„/1ì‹œê°„/ì¼ë´‰/ì£¼ë´‰ ì§€ì›</li>
                        <li>ì •í™•í•œ ì—…ë¹„íŠ¸ ê±°ë˜ì†Œ ë°ì´í„°ë¡œ ì•ˆì •ì ì¸ ë¶„ì„!</li>
                    </ul>
                    
                    <div style="margin-top: 15px; padding: 10px; background: rgba(33, 150, 243, 0.1); border-radius: 5px;">
                        <h5 style="color: #2196F3; margin: 0 0 10px 0;">ğŸ“ˆ ì•”í˜¸í™”í ì „ìš© ì‹œìŠ¤í…œ:</h5>
                        <ul style="color: #ccc; font-size: 0.8em; margin: 5px 0;">
                            <li>ì—…ë¹„íŠ¸ ê³µì‹ APIë¡œ ì •í™•í•œ ì‹¤ì‹œê°„ ë°ì´í„° ì œê³µ</li>
                            <li>ë¹„íŠ¸ì½”ì¸, ì´ë”ë¦¬ì›€ ì „ë¬¸ ê¸°ìˆ ì  ë¶„ì„</li>
                            <li>ì£¼ì‹ ë°ì´í„° ë¶ˆì•ˆì •ì„± ë¬¸ì œ í•´ê²°ë¡œ ì‹ ë¢°ì„± í–¥ìƒ</li>
                        </ul>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function saveApiKeys() {
            const openaiKey = document.getElementById('apiKeyInput').value.trim();
            const alphaVantageKey = document.getElementById('alphaVantageKeyInput').value.trim();
            const twelveDataKey = document.getElementById('twelveDataKeyInput').value.trim();
            const polygonKey = document.getElementById('polygonKeyInput').value.trim();
            const finnhubKey = document.getElementById('finnhubKeyInput').value.trim();
            
            if (openaiKey) {
                OPENAI_API_KEY = openaiKey;
                localStorage.setItem('openaiApiKey', openaiKey);
            }
            
            if (alphaVantageKey) {
                ALPHA_VANTAGE_API_KEY = alphaVantageKey;
                localStorage.setItem('alphaVantageApiKey', alphaVantageKey);
            }
            
            if (twelveDataKey) {
                TWELVE_DATA_API_KEY = twelveDataKey;
                localStorage.setItem('twelveDataApiKey', twelveDataKey);
            }
            
            if (polygonKey) {
                POLYGON_API_KEY = polygonKey;
                localStorage.setItem('polygonApiKey', polygonKey);
            }
            
            if (finnhubKey) {
                FINNHUB_API_KEY = finnhubKey;
                localStorage.setItem('finnhubApiKey', finnhubKey);
            }
            
            closeApiModal();
            
            // ì„±ê³µ ë©”ì‹œì§€
            const statusEl = document.getElementById('status');
            if (statusEl) {
                statusEl.innerHTML = 'âœ… API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!';
                setTimeout(() => {
                    statusEl.innerHTML = 'ì¤€ë¹„ ì™„ë£Œ';
                }, 2000);
            }
        }

        // Twelve Data APIë¡œ ì£¼ì‹ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchTwelveData(symbol) {
            if (!TWELVE_DATA_API_KEY) {
                throw new Error('Twelve Data API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }
            
            const apiUrl = `https://api.twelvedata.com/time_series?symbol=${symbol}&interval=1day&apikey=${TWELVE_DATA_API_KEY}&outputsize=100`;
            
            console.log(`ğŸ“¡ Twelve Dataë¡œ ${symbol} ë°ì´í„° ìš”ì²­ ì¤‘...`);
            
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('Twelve Data API í˜¸ì¶œ ì‹¤íŒ¨');
            
            const data = await response.json();
            
            if (data.status === 'error') {
                throw new Error(`Twelve Data ì˜¤ë¥˜: ${data.message}`);
            }
            
            const values = data.values;
            if (!values) {
                throw new Error('Twelve Dataì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // ë°ì´í„° ë³€í™˜
            const reversedData = values.map(item => ({
                candle_date_time_kst: item.datetime + 'T00:00:00.000Z',
                trade_price: parseFloat(item.close),
                high_price: parseFloat(item.high),
                low_price: parseFloat(item.low),
                opening_price: parseFloat(item.open),
                candle_acc_trade_volume: parseInt(item.volume || 0)
            })).reverse();
            
            console.log(`âœ… ${symbol} Twelve Data ìˆ˜ì‹  ì™„ë£Œ:`, reversedData.length, 'ê°œ ìº”ë“¤');
            console.log(`ğŸ’° í˜„ì¬ê°€: $${reversedData[reversedData.length-1]?.trade_price?.toFixed(2)}`);
            
            return reversedData;
        }

        // Polygon.io APIë¡œ ì£¼ì‹ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchPolygonData(symbol) {
            if (!POLYGON_API_KEY) {
                throw new Error('Polygon API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }
            
            const endDate = new Date().toISOString().split('T')[0];
            const startDate = new Date(Date.now() - 100 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            const apiUrl = `https://api.polygon.io/v2/aggs/ticker/${symbol}/range/1/day/${startDate}/${endDate}?apikey=${POLYGON_API_KEY}`;
            
            console.log(`ğŸ“¡ Polygonìœ¼ë¡œ ${symbol} ë°ì´í„° ìš”ì²­ ì¤‘...`);
            
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('Polygon API í˜¸ì¶œ ì‹¤íŒ¨');
            
            const data = await response.json();
            
            if (data.status !== 'OK') {
                throw new Error(`Polygon ì˜¤ë¥˜: ${data.error || 'Unknown error'}`);
            }
            
            const results = data.results;
            if (!results) {
                throw new Error('Polygonì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // ë°ì´í„° ë³€í™˜
            const reversedData = results.map(item => ({
                candle_date_time_kst: new Date(item.t).toISOString(),
                trade_price: item.c,
                high_price: item.h,
                low_price: item.l,
                opening_price: item.o,
                candle_acc_trade_volume: item.v
            }));
            
            console.log(`âœ… ${symbol} Polygon ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ:`, reversedData.length, 'ê°œ ìº”ë“¤');
            console.log(`ğŸ’° í˜„ì¬ê°€: $${reversedData[reversedData.length-1]?.trade_price?.toFixed(2)}`);
            
            return reversedData;
        }

        // ë°ì´í„° ì†ŒìŠ¤ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateDataSourceIndicator(source, symbol, timestamp = null) {
            const statusEl = document.getElementById('status');
            const currentTime = new Date().toLocaleString('ko-KR', { 
                timeZone: 'Asia/Seoul',
                year: 'numeric',
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const dataTime = timestamp ? new Date(timestamp).toLocaleString('ko-KR', {
                timeZone: 'America/New_York',
                month: '2-digit',
                day: '2-digit', 
                hour: '2-digit',
                minute: '2-digit'
            }) : '';
            
            let sourceInfo = '';
            let color = '#4CAF50';
            
            switch(source) {
                case 'alpha_vantage':
                    sourceInfo = 'ğŸŸ¢ Alpha Vantage (ì‹¤ì‹œê°„)';
                    color = '#4CAF50';
                    break;
                case 'twelve_data':
                    sourceInfo = 'ğŸ”µ Twelve Data (ì‹¤ì‹œê°„)';
                    color = '#2196F3';
                    break;
                case 'polygon':
                    sourceInfo = 'ğŸŸ  Polygon (ì‹¤ì‹œê°„)';
                    color = '#FF9800';
                    break;
                case 'yahoo':
                    sourceInfo = 'ğŸŸ¡ Yahoo Finance (ì§€ì—° ê°€ëŠ¥)';
                    color = '#FFC107';
                    break;
                case 'mock':
                    sourceInfo = 'ğŸŸ£ ëª¨ì˜ ë°ì´í„° (ì‹¤ì œ ê°€ê²© ê¸°ë°˜)';
                    color = '#9C27B0';
                    break;
                default:
                    sourceInfo = 'â“ ì•Œ ìˆ˜ ì—†ëŠ” ì†ŒìŠ¤';
                    color = '#999';
            }
            
            if (statusEl) {
                statusEl.innerHTML = `
                    <div style="color: ${color}; font-weight: bold;">${sourceInfo}</div>
                    <div style="font-size: 0.8em; color: #ccc; margin-top: 5px;">
                        ì—…ë°ì´íŠ¸: ${currentTime} (KST)
                        ${dataTime ? `<br>ë°ì´í„° ì‹œì : ${dataTime} (ET)` : ''}
                        ${symbol ? `<br>ì‹¬ë³¼: ${symbol}` : ''}
                    </div>
                `;
            }
        }

        // Alpha Vantage API ìˆ˜ì • - ì†ŒìŠ¤ í‘œì‹œ ì¶”ê°€
        async function fetchAlphaVantageData(symbol) {
            if (!ALPHA_VANTAGE_API_KEY) {
                throw new Error('Alpha Vantage API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤');
            }
            
            const apiUrl = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${ALPHA_VANTAGE_API_KEY}&outputsize=compact`;
            
            console.log(`ğŸ“¡ Alpha Vantageë¡œ ${symbol} ì‹¤ì‹œê°„ ë°ì´í„° ìš”ì²­ ì¤‘...`);
            
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('Alpha Vantage API í˜¸ì¶œ ì‹¤íŒ¨');
            
            const data = await response.json();
            
            if (data['Error Message']) {
                throw new Error(`Alpha Vantage ì˜¤ë¥˜: ${data['Error Message']}`);
            }
            
            if (data['Note']) {
                throw new Error('Alpha Vantage API í˜¸ì¶œ í•œë„ ì´ˆê³¼');
            }
            
            const timeSeries = data['Time Series (Daily)'];
            if (!timeSeries) {
                throw new Error('Alpha Vantage ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // ë°ì´í„° ë³€í™˜
            const reversedData = Object.entries(timeSeries)
                .map(([date, values]) => ({
                    candle_date_time_kst: date + 'T00:00:00.000Z',
                    trade_price: parseFloat(values['4. close']),
                    high_price: parseFloat(values['2. high']),
                    low_price: parseFloat(values['3. low']),
                    opening_price: parseFloat(values['1. open']),
                    candle_acc_trade_volume: parseInt(values['5. volume'])
                }))
                .sort((a, b) => new Date(a.candle_date_time_kst) - new Date(b.candle_date_time_kst));
            
            const latestDate = Object.keys(timeSeries)[0]; // ê°€ì¥ ìµœê·¼ ë‚ ì§œ
            console.log(`âœ… ${symbol} Alpha Vantage ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ:`, reversedData.length, 'ê°œ ìº”ë“¤');
            console.log(`ğŸ’° í˜„ì¬ê°€: $${reversedData[reversedData.length-1]?.trade_price?.toFixed(2)}`);
            console.log(`ğŸ“… ìµœì‹  ë°ì´í„° ë‚ ì§œ: ${latestDate} (ET)`);
            
            // ë°ì´í„° ì†ŒìŠ¤ í‘œì‹œ
            updateDataSourceIndicator('alpha_vantage', symbol, latestDate);
            
            return reversedData;
        }

        // ì‹ í˜¸ ê°•ë„ì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë§¤í•‘
        function getSignalClass(signal, confidence) {
            const normalizedConfidence = confidence / 100; // 0-1 ë²”ìœ„ë¡œ ì •ê·œí™”
            
            if (signal === 'BUY') {
                if (normalizedConfidence >= 0.8) return 'signal-strong-buy';
                else if (normalizedConfidence >= 0.6) return 'signal-buy';
                else return 'signal-weak-buy';
            } else if (signal === 'SELL') {
                if (normalizedConfidence >= 0.8) return 'signal-strong-sell';
                else if (normalizedConfidence >= 0.6) return 'signal-sell';
                else return 'signal-weak-sell';
            }
            return 'signal-hold';
        }

                 // ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ìƒ‰ê¹” ëŒ€ì‹  í…ìŠ¤íŠ¸ í‘œì‹œ)
         function forceUpdateButtonColor(coin, analysisData) {
             const btnElement = document.querySelector(`[data-coin="${coin}"]`);
             if (!btnElement) {
                 console.error(`ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${coin}`);
                 return;
             }
             
             const signal = analysisData.signal;
             const confidence = analysisData.confidence || 50;
             
             console.log(`ğŸ”„ ${coin} ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì‹œì‘:`, { signal, confidence });
             
             // ëª¨ë“  ì‹ í˜¸ í´ë˜ìŠ¤ ì œê±°
             const allSignalClasses = [
                 'signal-strong-buy', 'signal-buy', 'signal-weak-buy',
                 'signal-hold', 'signal-weak-sell', 'signal-sell', 'signal-strong-sell'
             ];
             
             allSignalClasses.forEach(cls => {
                 btnElement.classList.remove(cls);
             });
             
             // ìƒˆë¡œìš´ í´ë˜ìŠ¤ ê²°ì • ë° ì¶”ê°€
             let targetClass = 'signal-hold';
             if (signal === 'ë§¤ìˆ˜') {
                 if (confidence >= 80) targetClass = 'signal-strong-buy';
                 else if (confidence >= 70) targetClass = 'signal-buy';
                 else targetClass = 'signal-weak-buy';
             } else if (signal === 'ë§¤ë„') {
                 if (confidence >= 80) targetClass = 'signal-strong-sell';
                 else if (confidence >= 70) targetClass = 'signal-sell';
                 else targetClass = 'signal-weak-sell';
             }
             
             // í´ë˜ìŠ¤ ì¶”ê°€ (CSSì—ì„œ ìë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ í‘œì‹œë¨)
             btnElement.classList.add(targetClass);
             
             console.log(`âœ… ${coin} ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${targetClass} (${signal} ${confidence}%)`);
             
             // íˆ´íŒ ì—…ë°ì´íŠ¸
             btnElement.setAttribute('title', 
                 `${coinInfo[coin].name}\nì‹ í˜¸: ${signal} (${confidence}%)\nì—…ë°ì´íŠ¸: ${new Date().toLocaleTimeString('ko-KR')}`);
         }

         // ë‹¨ì¼ ì½”ì¸ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
         function updateSingleCoinButtonColor(coin) {
             const btnElement = document.querySelector(`[data-coin="${coin}"]`);
             if (btnElement && allCoinSignals[coin]) {
                 const signalData = allCoinSignals[coin];
                 
                 // ê¸°ì¡´ ì‹ í˜¸ í´ë˜ìŠ¤ ì œê±°
                 btnElement.classList.remove(
                     'signal-strong-buy', 'signal-buy', 'signal-weak-buy',
                     'signal-hold', 'signal-weak-sell', 'signal-sell', 'signal-strong-sell'
                 );
                 
                 // ìƒˆë¡œìš´ ì‹ í˜¸ í´ë˜ìŠ¤ ì¶”ê°€ (CSSì—ì„œ ìë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ í‘œì‹œ)
                 const signalClass = getSignalClass(signalData.signal, signalData.confidence);
                 btnElement.classList.add(signalClass);
                 
                 // íˆ´íŒì— ì‹ í˜¸ ì •ë³´ ì¶”ê°€
                 const signalText = signalData.signal;
                 const confidenceText = `${signalData.confidence}%`;
                 const timeText = signalData.lastUpdate ? 
                     new Date(signalData.lastUpdate).toLocaleTimeString('ko-KR') : 'ë¶„ì„ ëŒ€ê¸°';
                 
                 btnElement.setAttribute('title', 
                     `${coinInfo[coin].name}\nì‹ í˜¸: ${signalText} (${confidenceText})\nì—…ë°ì´íŠ¸: ${timeText}`);
                     
                 console.log(`${coin} ë²„íŠ¼ ì‹ í˜¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸: ${signalClass} (${signalText} ${confidenceText})`);
             }
         }

         // ëª¨ë“  ì½”ì¸ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
         function updateAllCoinButtonColors() {
             Object.keys(allCoinSignals).forEach(coin => {
                 updateSingleCoinButtonColor(coin);
             });
         }

        // ë‹¨ì¼ ì½”ì¸ì˜ ì‹ í˜¸ ë¶„ì„ ìˆ˜í–‰
        async function analyzeCoinSignal(coin, data) {
            try {
                if (!data || data.length < 14) {
                    console.log(`${coin}: ë¶„ì„ì„ ìœ„í•œ ì¶©ë¶„í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
                    return;
                }

                const closes = data.map(d => d.trade_price);
                const volumes = data.map(d => d.candle_acc_trade_volume);
                
                // ê¸°ìˆ ì  ì§€í‘œ ê³„ì‚°
                const rsi = calculateRSI(closes, 14);
                const macd = calculateMACD(closes);
                const bollinger = calculateBollingerBands(closes, 20, 2);
                const sma20 = calculateSMA(closes, 20);
                const sma60 = calculateSMA(closes, 60);
                
                if (rsi.length === 0 || macd.length === 0) {
                    console.log(`${coin}: ì§€í‘œ ê³„ì‚° ì‹¤íŒ¨`);
                    return;
                }

                const currentPrice = closes[closes.length - 1];
                const currentRSI = rsi[rsi.length - 1];
                const currentMACD = macd[macd.length - 1];
                const currentBB = bollinger[bollinger.length - 1];
                const currentSMA20 = sma20[sma20.length - 1];
                const currentSMA60 = sma60[sma60.length - 1];

                // ì‹ í˜¸ ë¶„ì„ ë¡œì§
                let buySignals = 0;
                let sellSignals = 0;
                let totalSignals = 0;

                // RSI ë¶„ì„
                if (currentRSI < 30) buySignals += 2; // ê³¼ë§¤ë„
                else if (currentRSI < 40) buySignals += 1;
                else if (currentRSI > 70) sellSignals += 2; // ê³¼ë§¤ìˆ˜
                else if (currentRSI > 60) sellSignals += 1;
                totalSignals += 2;

                // MACD ë¶„ì„
                if (currentMACD.macd > currentMACD.signal) buySignals += 1;
                else sellSignals += 1;
                totalSignals += 1;

                // ë³¼ë¦°ì €ë°´ë“œ ë¶„ì„
                if (currentPrice < currentBB.lower) buySignals += 2;
                else if (currentPrice > currentBB.upper) sellSignals += 2;
                else if (currentPrice < currentBB.middle) sellSignals += 1;
                else buySignals += 1;
                totalSignals += 2;

                // ì´ë™í‰ê·  ë¶„ì„
                if (currentPrice > currentSMA20 && currentSMA20 > currentSMA60) buySignals += 2;
                else if (currentPrice < currentSMA20 && currentSMA20 < currentSMA60) sellSignals += 2;
                totalSignals += 2;

                // ì‹ í˜¸ ê²°ì •
                let signal = 'HOLD';
                let confidence = 0;

                if (buySignals > sellSignals) {
                    signal = 'BUY';
                    confidence = Math.round((buySignals / totalSignals) * 100);
                } else if (sellSignals > buySignals) {
                    signal = 'SELL';
                    confidence = Math.round((sellSignals / totalSignals) * 100);
                } else {
                    signal = 'HOLD';
                    confidence = 50;
                }

                // ê²°ê³¼ ì €ì¥
                allCoinSignals[coin] = {
                    signal: signal,
                    confidence: confidence,
                    lastUpdate: new Date().toISOString()
                };

                console.log(`${coin} ì‹ í˜¸ ë¶„ì„ ì™„ë£Œ: ${signal} (${confidence}%)`);
                
            } catch (error) {
                console.error(`${coin} ì‹ í˜¸ ë¶„ì„ ì¤‘ ì˜¤ë¥˜:`, error);
            }
        }

        // ëª¨ë“  ì½”ì¸ ì‹ í˜¸ ë¶„ì„ ìˆ˜í–‰
        async function analyzeAllCoinSignals() {
            console.log('ëª¨ë“  ì½”ì¸ ì‹ í˜¸ ë¶„ì„ ì‹œì‘...');
            
            for (const coin of Object.keys(coinInfo)) {
                try {
                    const coinData = coinInfo[coin];
                    if (coinData.type === 'crypto') {
                        const url = `https://api.upbit.com/v1/candles/days?market=${coinData.market}&count=120`;
                        const response = await fetch(url);
                        
                        if (response.ok) {
                            const data = await response.json();
                            await analyzeCoinSignal(coin, data.reverse()); // ì˜¤ë˜ëœ ë°ì´í„°ë¶€í„° ì •ë ¬
                        } else {
                            console.error(`${coin} ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:`, response.status);
                        }
                    }
                } catch (error) {
                    console.error(`${coin} ë¶„ì„ ì¤‘ ì˜¤ë¥˜:`, error);
                }
                
                // API í˜¸ì¶œ ê°„ê²© ì¡°ì ˆ (ê³¼ë„í•œ ìš”ì²­ ë°©ì§€)
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            // ëª¨ë“  ë¶„ì„ ì™„ë£Œ í›„ ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            updateAllCoinButtonColors();
            console.log('ëª¨ë“  ì½”ì¸ ì‹ í˜¸ ë¶„ì„ ì™„ë£Œ');
        }

        // ì½”ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.coin-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const coin = this.getAttribute('data-coin');
                    selectCoin(coin);
                });
            });
            
            // ì´ˆê¸° ì‹ í˜¸ ë¶„ì„ ìˆ˜í–‰
            setTimeout(() => {
                analyzeAllCoinSignals();
            }, 2000);
            
            // 5ë¶„ë§ˆë‹¤ ëª¨ë“  ì½”ì¸ ì‹ í˜¸ ì¬ë¶„ì„
            setInterval(() => {
                analyzeAllCoinSignals();
            }, 5 * 60 * 1000); // 5ë¶„
        });
    </script>
</body>
</html> 